<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://shiroimon.kithub.f5.si/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/github.min.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/github-style.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/light.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/dark.css' />
    <link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/syntax.css' />
    <title>[BigQuery] Structured data processing 100&#39;s - Today I Learned | KitHub</title>
    
    <link rel="icon" type="image/x-icon" href='../../images/github-mark.png'>
    
    <meta name="theme-color" content="#1e2327">

    <link rel="stylesheet" href="https://shiroimon.kithub.f5.si/css/gist.css">
    <script type="text/javascript" src="https://shiroimon.kithub.f5.si/js/gist-dark-mode.js"></script>

    
    <meta name="description"
  content="ğŸ” Tried using SQL to learn the basics of data science." />
<meta name="keywords"
  content='blog' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://shiroimon.kithub.f5.si/post/bigquery_structured_data_processing_100/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="[BigQuery] Structured data processing 100&#39;s - Today I Learned | KitHub" />
<meta name="twitter:description"
  content="ğŸ” Tried using SQL to learn the basics of data science." />
<meta name="twitter:site" content="https://shiroimon.kithub.f5.si/" />
<meta name="twitter:creator" content="shiro" />
<meta name="twitter:image"
  content="https://shiroimon.kithub.f5.si/">


<meta property="og:type" content="article" />
<meta property="og:title" content="[BigQuery] Structured data processing 100&#39;s - Today I Learned | KitHub">
<meta property="og:description"
  content="ğŸ” Tried using SQL to learn the basics of data science." />
<meta property="og:url" content="https://shiroimon.kithub.f5.si/post/bigquery_structured_data_processing_100/" />
<meta property="og:site_name" content="[BigQuery] Structured data processing 100&#39;s" />
<meta property="og:image"
  content="https://shiroimon.kithub.f5.si/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2024-07-26 04:23:38 &#43;0900 JST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://shiroimon.kithub.f5.si/">
        <img class="octicon" height="32" width="32" src="../../images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://shiroimon.kithub.f5.si/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="../../images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
<main>
    
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
    <div class="px-0">
    <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
    <div class="flex-auto min-width-0 width-fit mr-3">
    <div class="d-flex">
        
        <div class="d-none d-md-block">
            <a class="avatar mr-2 flex-shrink-0" href="https://shiroimon.kithub.f5.si/">
                <img class=" avatar-user"
                  src="../../images/avatar.png"
                  width="32"
                  height="32">
            </a>
        </div>
        
        <div class="d-flex flex-column">
            
            <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                <span class="author"><a href="https://shiroimon.kithub.f5.si/"></a></span>
                <span class="path-divider">/</span>
                <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px"><a href="https://shiroimon.kithub.f5.si/post/bigquery_structured_data_processing_100/">[BigQuery] Structured data processing 100&#39;s</a></strong>
            </h1>
            
            <div class="note m-0">
                Created <relative-time datetime="Fri, 26 Jul 2024 04:23:38 &#43;0900" class="no-wrap">Fri, 26 Jul 2024 04:23:38 &#43;0900</relative-time>
                
                <span class="path-divider">|</span>
                Modified <relative-time datetime="Thu, 02 Oct 2025 00:30:36 &#43;0900" class="no-wrap">Thu, 02 Oct 2025 00:30:36 &#43;0900</relative-time>
                
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>

    
    <div class="container-lg px-3 new-discussion-timeline">
    <div class="repository-content gist-content">
    <div>
        <div class="js-gist-file-update-container js-task-list-container file-box">
        <div id="file-pytest" class="file my-2">
        
        <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
        <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
            
            <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
            <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                <svg aria-hidden="true" viewBox="0 0 16 16" class="octicon octicon-list-unordered" height="16" width="16">
                    <path fill-rule="evenodd"
                        d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z">
                    </path>
                </svg>
            </summary>
            <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                    <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list"></div>
                </div>
            </details-menu>
            18733 Words
            <span class="path-divider">|</span>
            24 min
            </div>

            
            <div class="file-actions flex-order-2 pt-0">
                
                <div class="d-none d-md-flex">
                    
                    
                    
                    <a class="muted-link mr-3" href="../../tags/bigquery">
                        <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                            <path fill-rule="evenodd"
                                d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                            </path>
                        </svg>
                        BigQuery
                    </a>
                    
                    
                    
                    <a class="muted-link mr-3" href="../../tags/sql">
                        <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                            <path fill-rule="evenodd"
                                d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                            </path>
                        </svg>
                        SQL
                    </a>
                    
                    
                    
                </div>
                
            </div>
        </div>
        </div>

        
        <div class="Box-body px-5 pb-5" style="z-index: 1">
            <article class="markdown-body entry-content container-lg"><!-- Icon Badge -->
<p><img src="https://img.shields.io/badge/-BigQuery-669DF6.svg?logo=googlebigquery&amp;style=flat&amp;color=F0F8FF" alt="BigQuery">
<img src="https://img.shields.io/badge/-PostgreSQL-4169E1.svg?logo=postgresql&amp;style=flat&amp;color=F0F8FF&amp;logoColor=4169E1" alt="PostgreSQL"></p>
<!-- Image -->
<p><img src="https://cdn-ssl-devio-img.classmethod.jp/wp-content/uploads/2020/09/gcp-eyecatch-bigquery_1200x630.png" alt="BigQuery"></p>
<h2 id="ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿åŠ å·¥ç·¨">ã€Œãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯ï¼ˆæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿åŠ å·¥ç·¨ï¼‰ã€<a class="anchor" aria-hidden="true" href="#ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿åŠ å·¥ç·¨"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h2>
<pre><code>æ•°å¹´å‰ã«éŠã‚“ã ãƒãƒƒã‚¯ã‚’å†æ ¡å…¼ã­ã¦...âš¾ï¸
å½“æ™‚ã®ã‚‚ã®ã ã‹ã‚‰ã‚¯ã‚¨ãƒªãŒã„ã‘ã¦ãªã„ã‘ã©è‰¯ã—ãªã«
</code></pre>
<ul>
<li>ä¸€èˆ¬ç¤¾å›£æ³•äººãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ãƒ†ã‚£ã‚¹ãƒˆå”ä¼š
<ul>
<li><a href="https://github.com/The-Japan-DataScientist-Society/100knocks-preprocess">https://github.com/The-Japan-DataScientist-Society/100knocks-preprocess</a></li>
<li>cf.
<ul>
<li><a href="https://digitalpr.jp/r/39499">ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åˆå­¦è€…ã®ãŸã‚ã®å®Ÿè·µçš„ãªå­¦ç¿’ç’°å¢ƒ ã€Œãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯ï¼ˆæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿åŠ å·¥ç·¨ï¼‰ã€ã‚’GitHubã«ç„¡æ–™å…¬é–‹</a> Digital PR Platform</li>
</ul>
</li>
<li>æ§‹ç¯‰ã‚¤ãƒ¡ãƒ¼ã‚¸
<ul>
<li><img src="https://user.pr-automation.jp/simg/1731/39499/700_277_202006151645535ee727319bac0.JPG" alt="img"></li>
<li>cf. <a href="https://digitalpr.jp/r/39499">Digital PR Platform</a></li>
</ul>
</li>
</ul>
</li>
<li><details>
  <summary>ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª</summary>
  <p></p>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">ã€€</span><span class="o">*</span><span class="w">ã€€</span><span class="k">from</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;category&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tb_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">category</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">reco</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;category&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;customer&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tb_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">reco</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;customer&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;geocode&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tb_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">geocode</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">reco</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;geocode&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;product&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tb_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">reco</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;product&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;receipt&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tb_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">reco</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;receipt&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;store&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tb_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">store</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">reco</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">col</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;store&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">reco</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p><img src="https://i.gyazo.com/efee5ae5565e1299e43fe26507b6d738.png" alt="img"></p>
  <p></p>
</details>
</li>
</ul>
<h2 id="100æœ¬ãƒãƒƒã‚¯sqlç·¨">100æœ¬ãƒãƒƒã‚¯(SQLç·¨)<a class="anchor" aria-hidden="true" href="#100æœ¬ãƒãƒƒã‚¯sqlç·¨"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h2>
<h3 id="s-001-">S-001 â˜…<a class="anchor" aria-hidden="true" href="#s-001-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å…¨é …ç›®ã‚’10ä»¶æŠ½å‡ºã—ã€ã©ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’ä¿æœ‰ã—ã¦ ã„ã‚‹ã‹ç›®è¦–ã§ç¢ºèªã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-002-">S-002 â˜…<a class="anchor" aria-hidden="true" href="#s-002-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ 10ä»¶è¡¨ç¤ºã•ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-003-">S-003 â˜…<a class="anchor" aria-hidden="true" href="#s-003-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€10ä»¶è¡¨ç¤ºã•ã›ã‚ˆã€‚ãŸã ã—ã€sales_ymdã¯sales_dateã«é …ç›®åã‚’å¤‰æ›´ã—ãªãŒã‚‰æŠ½å‡ºã™ã‚‹ã“ ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-004-">S-004 â˜…<a class="anchor" aria-hidden="true" href="#s-004-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚</p>
<ul>
<li>é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ&quot;CS018205000001&quot;</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CS018205000001&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-005-">S-005 â˜…<a class="anchor" aria-hidden="true" href="#s-005-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚</p>
<ul>
<li>é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ&quot;CS018205000001&quot;</li>
<li>å£²ä¸Šé‡‘é¡ï¼ˆamountï¼‰ãŒ1,000ä»¥ä¸Š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CS018205000001&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-006-">S-006 â˜…<a class="anchor" aria-hidden="true" href="#s-006-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID(customer_id)ã€ å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šæ•°é‡(quantity)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®š ã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚</p>
<ul>
<li>é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ&quot;CS018205000001&quot;</li>
<li>å£²ä¸Šé‡‘é¡ï¼ˆamountï¼‰ãŒ1,000ä»¥ä¸Šã¾ãŸã¯å£²ä¸Šæ•°é‡ï¼ˆquantityï¼‰ãŒ5ä»¥ä¸Š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CS018205000001&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="mi">1000</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">quantity</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-007-">S-007 â˜…<a class="anchor" aria-hidden="true" href="#s-007-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ã®ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID (customer_id)ã€å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚</p>
<ul>
<li>é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ&quot;CS018205000001&quot;</li>
<li>å£²ä¸Šé‡‘é¡ï¼ˆamountï¼‰ãŒ1,000ä»¥ä¸Š2,000ä»¥ä¸‹</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CS018205000001&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">2000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-008-">S-008 â˜…<a class="anchor" aria-hidden="true" href="#s-008-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥(sales_ymd)ã€é¡§å®¢ID(customer_id)ã€ å•†å“ã‚³ãƒ¼ãƒ‰(product_cd)ã€å£²ä¸Šé‡‘é¡(amount)ã®é †ã«åˆ—ã‚’æŒ‡å®šã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸ ã™ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚</p>
<ul>
<li>é¡§å®¢IDï¼ˆcustomer_idï¼‰ãŒ&quot;CS018205000001&quot;</li>
<li>å•†å“ã‚³ãƒ¼ãƒ‰ï¼ˆproduct_cdï¼‰ãŒ&quot;P071401019&quot;ä»¥å¤–</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CS018205000001&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">product_cd</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;P071401019&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-009-">S-009 â˜…<a class="anchor" aria-hidden="true" href="#s-009-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ä»¥ä¸‹ã®å‡¦ç†ã«ãŠã„ã¦ã€å‡ºåŠ›çµæœã‚’å¤‰ãˆãšã«ORã‚’ANDã«æ›¸ãæ›ãˆã‚ˆã€‚</p>
<p><code>select * from store where not (prefecture_cd = '13' or floor_area &gt; 900)</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">store</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">prefecture_cd</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">13</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">floor_area</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">900</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-010-">S-010 â˜…<a class="anchor" aria-hidden="true" href="#s-010-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã‹ã‚‰ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ãŒ&quot;S14&quot;ã§å§‹ã¾ã‚‹ã‚‚ã®ã ã‘å…¨é …ç›®æŠ½ å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">store</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;S14%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- where regexp_contains(store_cd, r&#39;^S14&#39;) #åˆ¥è§£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-011-">S-011 â˜…<a class="anchor" aria-hidden="true" href="#s-011-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰é¡§å®¢ID(customer_id)ã®æœ«å°¾ãŒ1ã®ã‚‚ã®ã ã‘å…¨é …ç›®æŠ½å‡º ã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;1$&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-012-">S-012 â˜…<a class="anchor" aria-hidden="true" href="#s-012-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã‹ã‚‰æ¨ªæµœå¸‚ã®åº—èˆ—ã ã‘å…¨é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">store</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">address</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%æ¨ªæµœå¸‚%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-013-">S-013 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-013-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰(status_cd)ã®å…ˆé ­ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒ ãƒˆã®Aã€œFã§å§‹ã¾ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®æŠ½å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;^(A|B|C|D|E|F)&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- regexp_contains(customer_id, r&#39;^(A-F)&#39;) -- åˆ¥è§£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">--    customer_id like &#39;A%&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- or customer_id like &#39;B%&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- or customer_id like &#39;C%&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- or customer_id like &#39;D%&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- or customer_id like &#39;E%&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- or customer_id like &#39;F%&#39; -- åˆ¥è§£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://qiita.com/mida12251141/items/27fe42ef01e83d5b063f">BigQueryã§LIKEæ–‡ã®è¤‡æ•°æ¡ä»¶æŒ‡å®šã‚’ORã‹ã‚‰æ­£è¦è¡¨ç¾ã«ç›´ã™</a> Qiita</p>
<h3 id="s-014-">S-014 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-014-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰(status_cd)ã®æœ«å°¾ãŒæ•°å­—ã®1ã€œ9ã§ çµ‚ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®æŠ½å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">status_cd</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;[1-9]$&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-015-">S-015 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-015-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰(status_cd)ã®å…ˆé ­ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®Aã€œFã§å§‹ã¾ã‚Šã€æœ«å°¾ãŒæ•°å­—ã®1ã€œ9ã§çµ‚ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®æŠ½å‡ºã—ã€10ä»¶ã ã‘è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">status_cd</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;^(A-F)-\d+-[1-9]$&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://murashun.jp/article/programming/regular-expression.html">åŸºæœ¬çš„ãªæ­£è¦è¡¨ç¾ä¸€è¦§</a> murashun.jp</p>
<h3 id="s-016-">S-016 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-016-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã‹ã‚‰ã€é›»è©±ç•ªå·(tel_no)ãŒ3æ¡-3æ¡-4æ¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¨é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">store</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">tel_no</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;\d{3}-\d{3}-\d{4}&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-017-">S-017 â˜…<a class="anchor" aria-hidden="true" href="#s-017-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‚’ç”Ÿå¹´æœˆæ—¥(birth_day)ã§é«˜é½¢é †ã«ã‚½ãƒ¼ãƒˆã—ã€å…ˆé ­10ä»¶ã‚’å…¨é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">birth_day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-018-">S-018 â˜…<a class="anchor" aria-hidden="true" href="#s-018-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‚’ç”Ÿå¹´æœˆæ—¥(birth_day)ã§è‹¥ã„é †ã«ã‚½ãƒ¼ãƒˆã—ã€å…ˆé ­10ä»¶ã‚’å…¨ é …ç›®è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">birth_day</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-019-">S-019 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-019-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€1ä»¶ã‚ãŸã‚Šã®å£²ä¸Šé‡‘é¡(amount)ãŒé«˜ã„é †ã«ãƒ© ãƒ³ã‚¯ã‚’ä»˜ä¸ã—ã€å…ˆé ­10ä»¶ã‚’æŠ½å‡ºã›ã‚ˆã€‚é …ç›®ã¯é¡§å®¢ID(customer_id)ã€å£²ä¸Šé‡‘é¡ (amount)ã€ä»˜ä¸ã—ãŸãƒ©ãƒ³ã‚¯ã‚’è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ã€‚ãªãŠã€å£²ä¸Šé‡‘é¡(amount)ãŒç­‰ã—ã„å ´åˆã¯åŒä¸€é †ä½ã‚’ä»˜ä¸ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ranking</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">ranking</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-020-">S-020 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-020-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€1ä»¶ã‚ãŸã‚Šã®å£²ä¸Šé‡‘é¡(amount)ãŒé«˜ã„é †ã«ãƒ© ãƒ³ã‚¯ã‚’ä»˜ä¸ã—ã€å…ˆé ­10ä»¶ã‚’æŠ½å‡ºã›ã‚ˆã€‚é …ç›®ã¯é¡§å®¢ID(customer_id)ã€å£²ä¸Šé‡‘é¡ (amount)ã€ä»˜ä¸ã—ãŸãƒ©ãƒ³ã‚¯ã‚’è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ã€‚ãªãŠã€å£²ä¸Šé‡‘é¡(amount)ãŒç­‰ã—ã„å ´ åˆã§ã‚‚åˆ¥é †ä½ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">dense_rank</span><span class="p">()</span><span class="w">ã€€</span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ranking</span><span class="w"> </span><span class="c1">-- row_number()åˆ¥è§£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">ranking</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>cf. <a href="https://gitpress.io/c/google_bigquery/google_bigquery_7">ã€BIGQUERYã€‘åˆ†æå…¥é–€ - SECTION7</a> Gitpress</p>
<h3 id="s-021-">S-021 â˜…<a class="anchor" aria-hidden="true" href="#s-021-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€ä»¶æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-022-">S-022 â˜…<a class="anchor" aria-hidden="true" href="#s-022-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®é¡§å®¢ID(customer_id)ã«å¯¾ã—ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ä»¶æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">customer_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unique_cnt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-023-">S-023 â˜…<a class="anchor" aria-hidden="true" href="#s-023-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã¨å£²ä¸Šæ•°é‡(quantity)ã‚’åˆè¨ˆã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_quantity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-024-">S-024 â˜…<a class="anchor" aria-hidden="true" href="#s-024-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«æœ€ã‚‚æ–°ã—ã„å£²ä¸Šæ—¥(sales_ymd)ã‚’æ±‚ã‚ã€10ä»¶è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">recently_sales_ymd</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recently_sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">last_value</span><span class="p">(</span><span class="n">sales_ymd</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">rows</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="n">UNBOUNDED</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">UNBOUNDED</span><span class="w"> </span><span class="n">FOLLOWING</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recently_sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">sales_ymd</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recently_sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-025-">S-025 â˜…<a class="anchor" aria-hidden="true" href="#s-025-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«æœ€ã‚‚å¤ã„å£²ä¸Šæ—¥ (sales_ymd)ã‚’æ±‚ã‚ã€10ä»¶è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">sales_ymd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-026-">S-026 â˜…<a class="anchor" aria-hidden="true" href="#s-026-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«æœ€ã‚‚æ–°ã—ã„å£²ä¸Š æ—¥(sales_ymd)ã¨å¤ã„å£²ä¸Šæ—¥ã‚’æ±‚ã‚ã€ä¸¡è€…ãŒç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’10ä»¶è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">sales_ymd</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recently</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">sales_ymd</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">formely</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">having</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">recently</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">formely</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-027-">S-027 â˜…<a class="anchor" aria-hidden="true" href="#s-027-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã®å¹³å‡ã‚’è¨ˆç®—ã—ã€é™é †ã§TOP5ã‚’è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="k">as</span><span class="w"> </span><span class="n">mean_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mean_amount</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-028-">S-028 â˜…<a class="anchor" aria-hidden="true" href="#s-028-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã®ä¸­å¤®å€¤ã‚’è¨ˆç®—ã—ã€é™é †ã§TOP5ã‚’è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">BigQuery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">median_amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">median_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">store_cd</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">median_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stcd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">median_amount</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="n">within</span><span class="w"> </span><span class="k">group</span><span class="p">(</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">median_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">median_amount</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-029-">S-029 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-029-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å•†å“ã‚³ãƒ¼ãƒ‰ (product_cd)ã®æœ€é »å€¤ã‚’æ±‚ã‚ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">BigQuery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">approx_top_count</span><span class="p">(</span><span class="n">product_cd</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">product_cd_mod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>cf.
<ul>
<li><a href="https://qiita.com/chatrate/items/e8d3a6cec35dfef4524b">ã€BigQueryã€‘StandardSQLã§æœ€é »å€¤ï¼ˆmodeã‚„topï¼‰</a> Qiita</li>
<li><a href="https://itips.krsw.biz/bigquery-how-to-get-average-median-mode/">BigQueryã§å¹³å‡å€¤ã€ä¸­å¤®å€¤ã€æœ€é »å€¤ã‚’SQLã§å–å¾—ã™ã‚‹æ–¹æ³•</a> ITips</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="err">ï¼ˆè§£æ³•ï¼‘ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">product_mode</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_cd</span><span class="p">,</span><span class="n">product_cd</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mode_cnt</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">store_cd</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rnk</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">receipt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">store_cd</span><span class="p">,</span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_cd</span><span class="p">,</span><span class="n">product_cd</span><span class="p">,</span><span class="w"> </span><span class="n">mode_cnt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">product_mode</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">rnk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">store_cd</span><span class="p">,</span><span class="n">product_cd</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="err">ï¼ˆè§£æ³•ï¼’ï¼‰</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">store_cd</span><span class="p">,</span><span class="w"> </span><span class="k">mode</span><span class="p">()</span><span class="w"> </span><span class="n">WITHIN</span><span class="w"> </span><span class="k">GROUP</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_cd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">receipt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">store_cd</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-030-">S-030 â˜…<a class="anchor" aria-hidden="true" href="#s-030-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã®æ¨™æœ¬åˆ†æ•£ã‚’è¨ˆç®—ã—ã€é™é †ã§TOP5ã‚’è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">BigQuery</span><span class="w"> </span><span class="err">è§£æ³•</span><span class="mi">1</span><span class="p">(</span><span class="err">ã‚¹ã‚¯ãƒ©ãƒƒãƒ</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mean_tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">diff_tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">float64</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">deviation_square</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">mean_tb</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">store_cd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">deviation_square</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">variance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">  </span><span class="n">diff_tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">variance</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">BigQuery</span><span class="w"> </span><span class="err">è§£æ³•</span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">variance</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">variance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">variance</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>cf. <a href="https://qiita.com/hagino3000/items/e9ed62638ebe54391188">BigQueryã§çµ±è¨ˆé‡ã‚’å‡ºã™æ™‚ã«ä½¿ã†ã‚¯ã‚¨ãƒªãƒ¡ãƒ¢</a> Qiita</p>
<h3 id="s-031-">S-031 â˜…<a class="anchor" aria-hidden="true" href="#s-031-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã®æ¨™æœ¬æ¨™æº–åå·®ã‚’è¨ˆç®—ã—ã€é™é †ã§TOP5ã‚’è¡¨ç¤ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">stddev</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">std</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-032-">S-032 â˜…<a class="anchor" aria-hidden="true" href="#s-032-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã«ã¤ã„ã¦ã€25%åˆ»ã¿ã§ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å€¤ã‚’æ±‚ã‚ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">BigQuery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">min</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">min</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">max</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">min</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w">  </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">window</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">store_cd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">statistic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="n">WITHIN</span><span class="w"> </span><span class="k">GROUP</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_25per</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="n">WITHIN</span><span class="w"> </span><span class="k">GROUP</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_50per</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span><span class="w"> </span><span class="n">WITHIN</span><span class="w"> </span><span class="k">GROUP</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_75per</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">WITHIN</span><span class="w"> </span><span class="k">GROUP</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_100per</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">receipt</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-033-">S-033 â˜…<a class="anchor" aria-hidden="true" href="#s-033-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€åº—èˆ—ã‚³ãƒ¼ãƒ‰(store_cd)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã®å¹³å‡ã‚’è¨ˆç®—ã—ã€330ä»¥ä¸Šã®ã‚‚ã®ã‚’æŠ½å‡ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">store_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">having</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mean</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">330</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-034-">S-034 â˜…<a class="anchor" aria-hidden="true" href="#s-034-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã‚’åˆè¨ˆã—ã¦å…¨é¡§å®¢ã®å¹³å‡ã‚’æ±‚ã‚ã‚ˆã€‚ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯ éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">-- select
</span></span></span><span class="line"><span class="cl"><span class="c1">--     customer_id
</span></span></span><span class="line"><span class="cl"><span class="c1">--     , sum(amount) as ttl_amount
</span></span></span><span class="line"><span class="cl"><span class="c1">-- from `100knocks.receipt`
</span></span></span><span class="line"><span class="cl"><span class="c1">-- where not regexp_contains(customer_id, r&#39;^Z&#39;)
</span></span></span><span class="line"><span class="cl"><span class="c1">-- group by customer_id
</span></span></span><span class="line"><span class="cl"><span class="c1">-- ;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_tb</span><span class="w"> </span><span class="k">as</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">not</span><span class="w"> </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;^Z&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">avg</span><span class="p">(</span><span class="n">ttl_amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">customer_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sum_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">receipt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">sum_amount</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">customer_amount</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-035-">S-035 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-035-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã«å¯¾ã—ã€é¡§å®¢ID(customer_id)ã”ã¨ã«å£²ä¸Šé‡‘é¡ (amount)ã‚’åˆè¨ˆã—ã¦å…¨é¡§å®¢ã®å¹³å‡ã‚’æ±‚ã‚ã€å¹³å‡ä»¥ä¸Šã«è²·ã„ç‰©ã‚’ã—ã¦ã„ã‚‹é¡§å®¢ã‚’æŠ½å‡ºã›ã‚ˆã€‚ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ã€‚ãªãŠã€ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã ã‘è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_tb</span><span class="w"> </span><span class="k">as</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">not</span><span class="w"> </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;^Z&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ttl_amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">ttl_amount</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">customer_tb</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-036-">S-036 â˜…<a class="anchor" aria-hidden="true" href="#s-036-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã¨åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã‚’å†…éƒ¨çµåˆã—ã€ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´° ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨é …ç›®ã¨åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«ã®åº—èˆ—å(store_name)ã‚’10ä»¶è¡¨ç¤ºã•ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">receipt</span><span class="p">.</span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="n">store_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w"> </span><span class="n">receipt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">store_cd</span><span class="p">,</span><span class="w"> </span><span class="n">store_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">store</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">store_cd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-037-">S-037 â˜…<a class="anchor" aria-hidden="true" href="#s-037-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã¨ã‚«ãƒ†ã‚´ãƒªãƒ†ãƒ¼ãƒ–ãƒ«(category)ã‚’å†…éƒ¨çµåˆã—ã€å•†å“ãƒ†ãƒ¼ãƒ–ãƒ« ã®å…¨é …ç›®ã¨ã‚«ãƒ†ã‚´ãƒªãƒ†ãƒ¼ãƒ–ãƒ«ã®å°åŒºåˆ†å(category_small_name)ã‚’10ä»¶è¡¨ç¤ºã•ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">category_major_cd</span><span class="p">,</span><span class="w"> </span><span class="n">category_medium_cd</span><span class="p">,</span><span class="w"> </span><span class="n">category_small_cd</span><span class="p">,</span><span class="w"> </span><span class="n">category_small_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">category</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">using</span><span class="p">(</span><span class="n">category_major_cd</span><span class="p">,</span><span class="w"> </span><span class="n">category_medium_cd</span><span class="p">,</span><span class="w"> </span><span class="n">category_small_cd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- on
</span></span></span><span class="line"><span class="cl"><span class="c1">--         p.category_major_cd =c.category_major_cd
</span></span></span><span class="line"><span class="cl"><span class="c1">--     and p.category_medium_cd=c.category_medium_cd
</span></span></span><span class="line"><span class="cl"><span class="c1">--     and p.category_small_cd =c.category_small_cd
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>select
    p.*
    , c.category_small_name
from
    `100knoks.product` p
join
    `100knoks.category` c using(category_small_cd)
limit 10
;
</code></pre><h3 id="s-038-">S-038 â˜…<a class="anchor" aria-hidden="true" href="#s-038-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã¨ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰ã€å„é¡§å®¢ã”ã¨ã®å£²ä¸Š é‡‘é¡åˆè¨ˆã‚’æ±‚ã‚ã‚ˆã€‚ãŸã ã—ã€å£²ä¸Šå®Ÿç¸¾ãŒãªã„é¡§å®¢ã«ã¤ã„ã¦ã¯å£²ä¸Šé‡‘é¡ã‚’0ã¨ã—ã¦è¡¨ç¤ºã•ã› ã‚‹ã“ã¨ã€‚ã¾ãŸã€é¡§å®¢ã¯æ€§åˆ¥ã‚³ãƒ¼ãƒ‰(gender_cd)ãŒå¥³æ€§(1)ã§ã‚ã‚‹ã‚‚ã®ã‚’å¯¾è±¡ã¨ã—ã€éä¼šå“¡(é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã‚‚ã®)ã¯é™¤å¤–ã™ã‚‹ã“ã¨ã€‚ãªãŠã€çµæœã¯10ä»¶ã ã‘è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">-- with customer_amount as(
</span></span></span><span class="line"><span class="cl"><span class="c1">--     select
</span></span></span><span class="line"><span class="cl"><span class="c1">--         customer_id
</span></span></span><span class="line"><span class="cl"><span class="c1">--         , sum(amount) as ttl_amount
</span></span></span><span class="line"><span class="cl"><span class="c1">--     from `project.100knocks.receipt`
</span></span></span><span class="line"><span class="cl"><span class="c1">--     group by customer_id
</span></span></span><span class="line"><span class="cl"><span class="c1">-- )
</span></span></span><span class="line"><span class="cl"><span class="c1">-- select
</span></span></span><span class="line"><span class="cl"><span class="c1">--     customer_id
</span></span></span><span class="line"><span class="cl"><span class="c1">--     , coalesce(ttl_amount, 0) as ttl_amount
</span></span></span><span class="line"><span class="cl"><span class="c1">-- from `project.100knocks.customer`
</span></span></span><span class="line"><span class="cl"><span class="c1">-- join customer_amount using(customer_id)
</span></span></span><span class="line"><span class="cl"><span class="c1">-- -- where
</span></span></span><span class="line"><span class="cl"><span class="c1">-- order by ttl_amount
</span></span></span><span class="line"><span class="cl"><span class="c1">-- ;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">join</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">gender_cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>cf. <a href="https://spirits.appirits.com/doruby/8666/">SQLé–¢æ•°coalesceã®ä½¿ã„æ–¹ã¨èª­ã¿æ–¹</a> Sppirits</p>
<h3 id="s-039-">S-039 â˜…<a class="anchor" aria-hidden="true" href="#s-039-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã‹ã‚‰å£²ä¸Šæ—¥æ•°ã®å¤šã„é¡§å®¢ã®ä¸Šä½20ä»¶ã¨ã€å£²ä¸Šé‡‘é¡åˆè¨ˆã®å¤šã„é¡§å®¢ã®ä¸Šä½20ä»¶ã‚’æŠ½å‡ºã—ã€å®Œå…¨å¤–éƒ¨çµåˆã›ã‚ˆã€‚ãŸã ã—ã€éä¼šå“¡(é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã‚‚ã®)ã¯é™¤å¤–ã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">sales_ymd</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">days</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">days</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-040-">S-040 â˜…<a class="anchor" aria-hidden="true" href="#s-040-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…¨ã¦ã®åº—èˆ—ã¨å…¨ã¦ã®å•†å“ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ä½•ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã¨ãªã‚‹ã‹èª¿æŸ»ã—ãŸã„ã€‚åº—èˆ— (store)ã¨å•†å“(product)ã‚’<strong>ç›´ç©</strong>ã—ãŸä»¶æ•°ã‚’è¨ˆç®—ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">-- select
</span></span></span><span class="line"><span class="cl"><span class="c1">--     (select
</span></span></span><span class="line"><span class="cl"><span class="c1">--         count(distinct store_cd)
</span></span></span><span class="line"><span class="cl"><span class="c1">--     from `100knocks.store`)
</span></span></span><span class="line"><span class="cl"><span class="c1">--     union all
</span></span></span><span class="line"><span class="cl"><span class="c1">--     (select
</span></span></span><span class="line"><span class="cl"><span class="c1">--         count(distinct product_cd)
</span></span></span><span class="line"><span class="cl"><span class="c1">--     from `100knocks.product`) as ttl_record
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">store</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">cross</span><span class="w"> </span><span class="k">join</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>cf. <a href="https://developer.feedforce.jp/entry/2019/03/19/170000">cross join ã‚’çŸ¥ã‚‹ã¨ join ãŒæ›¸ãã‚„ã™ããªã‚‹ã‚ˆã€ã¨ã„ã†è©±</a> Feedforce Developer Blog</p>
<h3 id="s-041-">S-041 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-041-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’æ—¥ä»˜(sales_ymd)ã”ã¨ã«é›†è¨ˆã—ã€å‰æ—¥ã‹ã‚‰ã®å£²ä¸Šé‡‘é¡å¢—æ¸›ã‚’è¨ˆç®—ã›ã‚ˆã€‚ãªãŠã€è¨ˆç®—çµæœã¯10ä»¶è¡¨ç¤ºã™ã‚Œã°ã‚ˆã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- , amount
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- , lag(amount) over(order by sales_ymd) as lag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sales_ymd</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>%%sql
WITH sales_amount_by_date AS (
    SELECT sales_ymd, SUM(amount) as amount FROM receipt
    GROUP BY sales_ymd
    ORDER BY sales_ymd
)
SELECT sales_ymd, LAG(sales_ymd, 1) OVER(ORDER BY sales_ymd) lag_ymd,
    amount,
    LAG(amount, 1) OVER(ORDER BY sales_ymd) as lag_amount,
    amount - LAG(amount, 1) OVER(ORDER BY sales_ymd) as diff_amount
FROM sales_amount_by_date
LIMIT 10;
</code></pre><p>Cf.</p>
<ul>
<li><a href="https://qiita.com/kota_fujimura/items/cff732bb9acb47510a03">ã€BigQueryã€‘LAGé–¢æ•°ï¼ŒLEADé–¢æ•°ã®ä½¿ã„æ–¹
</a> - Qiita</li>
<li><a href="https://gitpress.io/c/google_bigquery/google_bigquery_7">ã€BIGQUERYã€‘åˆ†æå…¥é–€ - SECTION7</a> - .tk</li>
</ul>
<h3 id="s-042-">S-042 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-042-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’æ—¥ä»˜(sales_ymd)ã”ã¨ã«é›† è¨ˆã—ã€å„æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã€1æ—¥å‰ã€2æ—¥å‰ã€3æ—¥å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆã›ã‚ˆã€‚çµæœã¯10ä»¶ è¡¨ç¤ºã™ã‚Œã°ã‚ˆã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_lag_1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_lag_2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_lag_3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">window</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">w</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">sales_ymd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-043-">S-043 â˜…<a class="anchor" aria-hidden="true" href="#s-043-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã¨é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‚’çµåˆã—ã€æ€§åˆ¥ (gender)ã¨å¹´ä»£(ageã‹ã‚‰è¨ˆç®—)ã”ã¨ã«å£²ä¸Šé‡‘é¡(amount)ã‚’åˆè¨ˆã—ãŸå£²ä¸Šã‚µãƒãƒªãƒ†ãƒ¼ ãƒ–ãƒ«(sales_summary)ã‚’ä½œæˆã›ã‚ˆã€‚æ€§åˆ¥ã¯0ãŒç”·æ€§ã€1ãŒå¥³æ€§ã€9ãŒä¸æ˜ã‚’è¡¨ã™ã‚‚ã®ã¨ã™ ã‚‹ã€‚ãŸã ã—ã€é …ç›®æ§‹æˆã¯å¹´ä»£ã€å¥³æ€§ã®å£²ä¸Šé‡‘é¡ã€ç”·æ€§ã®å£²ä¸Šé‡‘é¡ã€æ€§åˆ¥ä¸æ˜ã®å£²ä¸Šé‡‘é¡ã®4é … ç›®ã¨ã™ã‚‹ã“ã¨(ç¸¦ã«å¹´ä»£ã€æ¨ªã«æ€§åˆ¥ã®ã‚¯ãƒ­ã‚¹é›†è¨ˆ)ã€‚ã¾ãŸã€å¹´ä»£ã¯10æ­³ã”ã¨ã®éšç´šã¨ã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;10&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;20&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;30&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;40&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">59</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;50&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">69</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;60&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">79</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;70&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="s2">&#34;Over80&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">gender</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">age_category</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">male</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">where</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;ç”·æ€§&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">age_category</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">female</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;å¥³æ€§&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">age_category</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">age_category</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">unknown</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;ä¸æ˜&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">age_category</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">age_category</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>%%sql

-- SQLå‘ãã§ã¯ãªã„ãŸã‚ã€ã‚„ã‚„å¼·å¼•ã«è¨˜è¼‰ã™ã‚‹ï¼ˆã‚«ãƒ†ã‚´ãƒªæ•°ãŒå¤šã„ã¨ãã¯ã¨ã¦ã‚‚é•·ã„SQLã¨ãªã£ã¦ã—ã¾ã†ç‚¹ã«æ³¨æ„ï¼‰

DROP TABLE IF EXISTS sales_summary;

CREATE TABLE sales_summary AS
    WITH gender_era_amount AS (
        SELECT c.gender_cd,
        TRUNC(age/ 10) * 10 AS era,
        SUM(r.amount) AS amount
        FROM customer c
        JOIN receipt r
        ON c.customer_id = r.customer_id
        GROUP BY c.gender_cd, era
    )
    select era,
        MAX(CASE gender_cd WHEN &#39;0&#39; THEN amount ELSE 0 END) AS male ,
        MAX(CASE gender_cd WHEN &#39;1&#39; THEN amount ELSE 0 END) AS female,
        MAX(CASE gender_cd WHEN &#39;9&#39; THEN amount ELSE 0 END) AS unknown
    FROM gender_era_amount
    GROUP BY era
    ORDER BY era
;
SELECT * FROM sales_summary;
</code></pre><p><a href="https://gist.github.com/GitHiru/ebee5fff3f44451cbcebfa7d408a160f">ãƒ¡ãƒ¢</a> - Gist</p>
<h3 id="s-044-">S-044 â˜…<a class="anchor" aria-hidden="true" href="#s-044-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å‰è¨­å•ã§ä½œæˆã—ãŸå£²ä¸Šã‚µãƒãƒªãƒ†ãƒ¼ãƒ–ãƒ«(sales_summary)ã¯æ€§åˆ¥ã®å£²ä¸Šã‚’æ¨ªæŒã¡ã•ã›ãŸã‚‚ ã®ã§ã‚ã£ãŸã€‚ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰æ€§åˆ¥ã‚’ç¸¦æŒã¡ã•ã›ã€å¹´ä»£ã€æ€§åˆ¥ã‚³ãƒ¼ãƒ‰ã€å£²ä¸Šé‡‘é¡ã®3é …ç›® ã«å¤‰æ›ã›ã‚ˆã€‚ãŸã ã—ã€æ€§åˆ¥ã‚³ãƒ¼ãƒ‰ã¯ç”·æ€§ã‚’&quot;00&quot;ã€å¥³æ€§ã‚’&quot;01&quot;ã€ä¸æ˜ã‚’&quot;99&quot;ã¨ã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="w">              </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;10&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;20&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;30&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;40&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">59</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;50&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">69</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;60&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">79</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s2">&#34;70&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="k">else</span><span class="w"> </span><span class="s2">&#34;Over80&#39;s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;00&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">gender_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;ç”·æ€§&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">age_category</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">gender_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;å¥³æ€§&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">age_category</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;99&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">gender_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;ä¸æ˜&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">age_category</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">gender_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">age_category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-045-">S-045 â˜…<a class="anchor" aria-hidden="true" href="#s-045-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®ç”Ÿå¹´æœˆæ—¥(birth_day)ã¯æ—¥ä»˜å‹ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æœ‰ã—ã¦ã„ã‚‹ã€‚ ã“ã‚Œã‚’YYYYMMDDå½¢å¼ã®æ–‡å­—åˆ—ã«å¤‰æ›ã—ã€é¡§å®¢ID(customer_id)ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚ ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã‚’æŠ½å‡ºã™ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">replace</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">birth_day</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">birth_day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf.<a href="https://oreno-it.info/archives/2609">ã€SQLã€‘ç©ºç™½ã‚„ã‚¹ãƒšãƒ¼ã‚¹ã€0ã€ç‰¹å®šã®æ–‡å­—ã‚’å‰Šé™¤ã™ã‚‹æ–¹æ³•</a> - SEæ—¥è¨˜</p>
<pre tabindex="0"><code># PostgreSQL
%%sql
SELECT customer_id, TO_CHAR(birth_day, &#39;YYYYMMDD&#39;) FROM customer LIMIT 10;
</code></pre><h3 id="s-046-">S-046 â˜…<a class="anchor" aria-hidden="true" href="#s-046-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®ç”³ã—è¾¼ã¿æ—¥(application_date)ã¯YYYYMMDDå½¢å¼ã®æ–‡å­— åˆ—å‹ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æœ‰ã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã‚’æ—¥ä»˜å‹ã«å¤‰æ›ã—ã€é¡§å®¢ID(customer_id)ã¨ã¨ã‚‚ã« æŠ½å‡ºã›ã‚ˆã€‚ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã‚’æŠ½å‡ºã™ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">application_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>cf.
<ul>
<li><a href="https://ten-ezo.com/62ac07f58f3d46f08e1eee524476acd8">BigQueryã§stringå‹ã®æ–‡å­—åˆ—ã‹ã‚‰dateå‹ã®æ—¥ä»˜ã«å¤‰æ›ã™ã‚‹</a> TEN&rsquo;s page</li>
<li><a href="https://dev.classmethod.jp/articles/omoitsuki-sonoichi/">[å°ãƒã‚¿] BigQueryã§åŒºåˆ‡ã‚Šæ–‡å­—ã®ãªã„å¹´æœˆæ—¥ï¼ˆYYYYMMDDï¼‰ã‹ã‚‰æ—¥ä»˜å‹ï¼ˆYYYY-MM-DDï¼‰ã«ã™ã‚‹æ–¹æ³•</a> DevelopersIO</li>
<li>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">%%</span><span class="k">sql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">TO_DATE</span><span class="p">(</span><span class="n">application_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYYMMDD&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="s-047-">S-047 â˜…<a class="anchor" aria-hidden="true" href="#s-047-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šæ—¥(sales_ymd)ã¯YYYYMMDDå½¢å¼ã®æ•°å€¤å‹ã§ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æœ‰ã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã‚’æ—¥ä»˜å‹ã«å¤‰æ›ã—ã€ãƒ¬ã‚·ãƒ¼ãƒˆç•ªå·(receipt_no)ã€ãƒ¬ã‚·ãƒ¼ãƒˆã‚µ ãƒ–ç•ªå·(receipt_sub_no)ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã‚’æŠ½å‡ºã™ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">receipt_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">receipt_sub_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">limit10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-048-">S-048 â˜…<a class="anchor" aria-hidden="true" href="#s-048-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šã‚¨ãƒãƒƒã‚¯ç§’(sales_epoch)ã¯æ•°å€¤å‹ã®UNIXç§’ã§ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æœ‰ã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã‚’æ—¥ä»˜å‹ã«å¤‰æ›ã—ã€ãƒ¬ã‚·ãƒ¼ãƒˆç•ªå·(receipt_no)ã€ãƒ¬ã‚·ãƒ¼ãƒˆã‚µ ãƒ–ç•ªå·(receipt_sub_no)ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã‚’æŠ½å‡ºã™ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">receipt_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">receipt_sub_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">format_timestamp</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp_seconds</span><span class="p">(</span><span class="n">sales_epoch</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Asia/Tokyo&#39;</span><span class="p">)</span><span class="k">as</span><span class="w"> </span><span class="n">sales_epoch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">limit10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf.</p>
<ul>
<li><a href="https://qiita.com/hogeta_/items/06ffeb48e8148adfda57">Bigqueryã§unixtimeã‚’JSTã«å¤‰æ›ã™ã‚‹</a> - Qiita</li>
<li><a href="https://tokukichi.com/posts/444">BigQueryé–¢æ•° | unixtimeã‚’DATETIMEã«å¤‰æ›ã™ã‚‹</a> - ã¨ããã¡ã®ã‚†ã‚‹ãƒ­ã‚°</li>
<li><a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/timestamp_functions?hl=ja#timestamp_seconds">TIMESTAMP_SECONDS</a> - GoogleCloud</li>
</ul>
<pre tabindex="0"><code># PostgreSQL
%%sql

SELECT
    TO_TIMESTAMP(sales_epoch) as sales_date,
    receipt_no, receipt_sub_no
FROM receipt
LIMIT 10;
</code></pre><h3 id="s-049-">S-049 â˜…<a class="anchor" aria-hidden="true" href="#s-049-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šã‚¨ãƒãƒƒã‚¯ç§’(sales_epoch)ã‚’æ—¥ä»˜å‹ã«å¤‰æ›ã—ã€ ã€Œå¹´ã€ã ã‘å–ã‚Šå‡ºã—ã¦ãƒ¬ã‚·ãƒ¼ãƒˆç•ªå·(receipt_no)ã€ãƒ¬ã‚·ãƒ¼ãƒˆã‚µãƒ–ç•ªå·(receipt_sub_no) ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã‚’æŠ½å‡ºã™ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">receipt_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">receipt_sub_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">format_date</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">format_timestamp</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp_seconds</span><span class="p">(</span><span class="n">sales_epoch</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Asia/Tokyo&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">date</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_epoch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">limit10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://gitpress.io/c/google_bigquery/google_bigquery_6">BIGQUERYã€‘åˆ†æå…¥é–€ - SECTION6</a> Gitpress</p>
<pre tabindex="0"><code>%%sql

SELECT
    TO_CHAR(EXTRACT(YEAR FROM TO_TIMESTAMP(sales_epoch)),&#39;FM9999&#39;) as sales_year,
    receipt_no,
    receipt_sub_no
FROM receipt
LIMIT 10;
</code></pre><h3 id="s-050-">S-050 â˜…<a class="anchor" aria-hidden="true" href="#s-050-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šã‚¨ãƒãƒƒã‚¯ç§’(sales_epoch)ã‚’æ—¥ä»˜å‹ã«å¤‰æ›ã—ã€ ã€Œæœˆã€ã ã‘å–ã‚Šå‡ºã—ã¦ãƒ¬ã‚·ãƒ¼ãƒˆç•ªå·(receipt_no)ã€ãƒ¬ã‚·ãƒ¼ãƒˆã‚µãƒ–ç•ªå·(receipt_sub_no) ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚ãªãŠã€ã€Œæœˆã€ã¯0åŸ‹ã‚2æ¡ã§å–ã‚Šå‡ºã™ã“ã¨ã€‚ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã‚’æŠ½å‡ºã™ã‚Œã° è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">format_date</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">format_timestamp</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp_seconds</span><span class="p">(</span><span class="n">sales_epoch</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Asia/Tokyo&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">date</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_epoch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">receipt_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">receipt_sub_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-051-">S-051 â˜…<a class="anchor" aria-hidden="true" href="#s-051-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šã‚¨ãƒãƒƒã‚¯ç§’ã‚’æ—¥ä»˜å‹ã«å¤‰æ›ã—ã€ã€Œæ—¥ã€ã ã‘å–ã‚Šå‡º ã—ã¦ãƒ¬ã‚·ãƒ¼ãƒˆç•ªå·(receipt_no)ã€ãƒ¬ã‚·ãƒ¼ãƒˆã‚µãƒ–ç•ªå·(receipt_sub_no)ã¨ã¨ã‚‚ã«æŠ½å‡ºã› ã‚ˆã€‚ãªãŠã€ã€Œæ—¥ã€ã¯0åŸ‹ã‚2æ¡ã§å–ã‚Šå‡ºã™ã“ã¨ã€‚ãƒ‡ãƒ¼ã‚¿ã¯10ä»¶ã‚’æŠ½å‡ºã™ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">format_date</span><span class="p">(</span><span class="s1">&#39;%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">format_timestamp</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp_seconds</span><span class="p">(</span><span class="n">sales_epoch</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Asia/Tokyo&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">date</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_epoch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">receipt_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">receipt_sub_no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-052-">S-052 â˜…<a class="anchor" aria-hidden="true" href="#s-052-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢ID(customer_id)ã”ã¨ã« åˆè¨ˆã®ä¸Šã€å£²ä¸Šé‡‘é¡åˆè¨ˆã«å¯¾ã—ã¦2,000å††ä»¥ä¸‹ã‚’0ã€2,000å††ã‚ˆã‚Šå¤§ãã„é‡‘é¡ã‚’1ã«2å€¤åŒ–ã—ã€é¡§å®¢IDã€å£²ä¸Šé‡‘é¡åˆè¨ˆã¨ã¨ã‚‚ã«10ä»¶è¡¨ç¤ºã›ã‚ˆã€‚ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="k">when</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">label</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s2">&#34;Z%&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-053-">S-053 â˜…<a class="anchor" aria-hidden="true" href="#s-053-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®éƒµä¾¿ç•ªå·(postal_cd)ã«å¯¾ã—ã€æ±äº¬(å…ˆé ­3æ¡ãŒ100ã€œ209 ã®ã‚‚ã®)ã‚’1ã€ãã‚Œä»¥å¤–ã®ã‚‚ã®ã‚’0ã«2å€¤åŒ–ã›ã‚ˆã€‚ã•ã‚‰ã«ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt) ã¨çµåˆã—ã€å…¨æœŸé–“ã«ãŠã„ã¦å£²ä¸Šå®Ÿç¸¾ãŒã‚ã‚‹é¡§å®¢æ•°ã‚’ã€ä½œæˆã—ãŸ2å€¤ã”ã¨ã«ã‚«ã‚¦ãƒ³ãƒˆã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">customer_classification</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">postal_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">postal_cd</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;^[1][0-9][0-9]-&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">label_100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">regexp_contains</span><span class="p">(</span><span class="n">postal_cd</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="s1">&#39;^[2][0][0-9]-&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">label_200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">label_100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">label_200</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">label</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">customer_classification</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">label</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>%%sql

WITH cust AS (
    SELECT
        customer_id,
        postal_cd,
        CASE
            WHEN 100 &lt;= CAST(SUBSTR(postal_cd, 1, 3) AS INTEGER)
                    AND CAST(SUBSTR(postal_cd, 1, 3) AS INTEGER) &lt;= 209 THEN 1
            ELSE 0
        END AS postal_flg
    FROM customer
),
rect AS(
    SELECT
        customer_id,
        SUM(amount)
    FROM
        receipt
    GROUP BY
        customer_id
)
SELECT
    c.postal_flg, count(1)
FROM
    rect r
JOIN
    cust c
ON
    r.customer_id = c.customer_id
GROUP BY
    c.postal_flg
</code></pre><h3 id="s-054-">S-054 â˜…<a class="anchor" aria-hidden="true" href="#s-054-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®ä½æ‰€(address)ã¯ã€åŸ¼ç‰çœŒã€åƒè‘‰çœŒã€æ±äº¬éƒ½ã€ç¥å¥ˆå·çœŒã® ã„ãšã‚Œã‹ã¨ãªã£ã¦ã„ã‚‹ã€‚éƒ½é“åºœçœŒæ¯ã«ã‚³ãƒ¼ãƒ‰å€¤ã‚’ä½œæˆã—ã€é¡§å®¢IDã€ä½æ‰€ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚å€¤ã¯åŸ¼ç‰çœŒã‚’11ã€åƒè‘‰çœŒã‚’12ã€æ±äº¬éƒ½ã‚’13ã€ç¥å¥ˆå·çœŒã‚’14ã¨ã™ã‚‹ã“ã¨ã€‚çµæœã¯10ä»¶ è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;%åŸ¼ç‰çœŒ%&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;11&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;%åƒè‘‰çœŒ%&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;12&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;%æ±äº¬éƒ½%&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;13&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">like</span><span class="s1">&#39;%ç¥å¥ˆå·çœŒ%&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;14&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">pref_label</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>%%sql

-- SQLå‘ãã§ã¯ãªã„ãŸã‚ã€ã‚„ã‚„å¼·å¼•ã«è¨˜è¼‰ã™ã‚‹ï¼ˆã‚«ãƒ†ã‚´ãƒªæ•°ãŒå¤šã„ã¨ãã¯ã¨ã¦ã‚‚é•·ã„SQLã¨ãªã£ã¦ã—ã¾ã†ç‚¹ã«æ³¨æ„ï¼‰
SELECT
    customer_id,
    -- ç¢ºèªç”¨ã«ä½æ‰€ã‚‚è¡¨ç¤º
    address,
    CASE SUBSTR(address,1, 3)
        WHEN &#39;åŸ¼ç‰çœŒ&#39; THEN &#39;11&#39;
        WHEN &#39;åƒè‘‰çœŒ&#39; THEN &#39;12&#39;
        WHEN &#39;æ±äº¬éƒ½&#39; THEN &#39;13&#39;
        WHEN &#39;ç¥å¥ˆå·&#39; THEN &#39;14&#39;
    END AS prefecture_cd
FROM
    customer
LIMIT 10
</code></pre><h3 id="s-055-">S-055 â˜…<a class="anchor" aria-hidden="true" href="#s-055-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢ID(customer_id)ã”ã¨ã« åˆè¨ˆã—ã€ãã®åˆè¨ˆé‡‘é¡ã®å››åˆ†ä½ç‚¹ã‚’æ±‚ã‚ã‚ˆã€‚ãã®ä¸Šã§ã€é¡§å®¢ã”ã¨ã®å£²ä¸Šé‡‘é¡åˆè¨ˆã«å¯¾ã—ã¦ ä»¥ä¸‹ã®åŸºæº–ã§ã‚«ãƒ†ã‚´ãƒªå€¤ã‚’ä½œæˆã—ã€é¡§å®¢IDã€å£²ä¸Šé‡‘é¡åˆè¨ˆã¨ã¨ã‚‚ã«è¡¨ç¤ºã›ã‚ˆã€‚ã‚«ãƒ†ã‚´ãƒªå€¤ ã¯é †ã«1ã€œ4ã¨ã™ã‚‹ã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<ul>
<li>æœ€å°å€¤ä»¥ä¸Šç¬¬1å››åˆ†ä½æœªæº€ ãƒ»ãƒ»ãƒ» 1ã‚’ä»˜ä¸</li>
<li>ç¬¬1å››åˆ†ä½ä»¥ä¸Šç¬¬2å››åˆ†ä½æœªæº€ ãƒ»ãƒ»ãƒ» 2ã‚’ä»˜ä¸</li>
<li>ç¬¬2å››åˆ†ä½ä»¥ä¸Šç¬¬3å››åˆ†ä½æœªæº€ ãƒ»ãƒ»ãƒ» 3ã‚’ä»˜ä¸</li>
<li>ç¬¬3å››åˆ†ä½ä»¥ä¸Š ãƒ»ãƒ»ãƒ» 4ã‚’ä»˜ä¸</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">quatile</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">min</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">customer_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q1</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">q1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q2</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">q2</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q3</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">else</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">label</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">quatile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>%%sql

WITH sales_amount AS(
    SELECT
        customer_id,
        SUM(amount) as sum_amount
    FROM
        receipt
    GROUP BY
        customer_id
),
sales_pct AS (
    SELECT
        PERCENTILE_CONT(0.25) WITHIN GROUP(ORDER BY sum_amount) AS pct25,
        PERCENTILE_CONT(0.50) WITHIN GROUP(ORDER BY sum_amount) AS pct50,
        PERCENTILE_CONT(0.75) WITHIN GROUP(ORDER BY sum_amount) AS pct75
    FROM
        sales_amount
)
SELECT
    a.customer_id,
    a.sum_amount,
    CASE
        WHEN a.sum_amount &lt; pct25 THEN 1
        WHEN pct25 &lt;= a.sum_amount and a.sum_amount &lt; pct50 THEN 2
        WHEN pct50 &lt;= a.sum_amount and a.sum_amount &lt; pct75 THEN 3
        WHEN pct75 &lt;= a.sum_amount THEN 4
    END as pct_flg
FROM sales_amount a
CROSS JOIN sales_pct p
LIMIT 10
</code></pre><h3 id="s-056-">S-056 â˜…<a class="anchor" aria-hidden="true" href="#s-056-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®å¹´é½¢(age)ã‚’ã‚‚ã¨ã«10æ­³åˆ»ã¿ã§å¹´ä»£ã‚’ç®—å‡ºã—ã€é¡§å®¢ID (customer_id)ã€ç”Ÿå¹´æœˆæ—¥(birth_day)ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚ãŸã ã—ã€60æ­³ä»¥ä¸Šã¯å…¨ã¦60 æ­³ä»£ã¨ã™ã‚‹ã“ã¨ã€‚å¹´ä»£ã‚’è¡¨ã™ã‚«ãƒ†ã‚´ãƒªåã¯ä»»æ„ã¨ã™ã‚‹ã€‚å…ˆé ­10ä»¶ã‚’è¡¨ç¤ºã•ã›ã‚Œã°ã‚ˆã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">birth_day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="n">age</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;10æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="mi">20</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;20æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="mi">30</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;30æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="mi">40</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;40æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;50æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;60æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">era_label</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-057-">S-057 â˜…<a class="anchor" aria-hidden="true" href="#s-057-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å‰å•é¡Œã®æŠ½å‡ºçµæœã¨æ€§åˆ¥ã‚³ãƒ¼ãƒ‰(gender_cd)ã«ã‚ˆã‚Šã€æ–°ãŸã«æ€§åˆ¥Ã—å¹´ä»£ã®çµ„ã¿åˆã‚ã›ã‚’ è¡¨ã™ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã›ã‚ˆã€‚çµ„ã¿åˆã‚ã›ã‚’è¡¨ã™ã‚«ãƒ†ã‚´ãƒªã®å€¤ã¯ä»»æ„ã¨ã™ã‚‹ã€‚å…ˆé ­10ä»¶ ã‚’è¡¨ç¤ºã•ã›ã‚Œã°ã‚ˆã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">birth_day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="n">gender_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">when</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;ç”·æ€§&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">when</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;å¥³æ€§&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;ä¸æ˜&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">end</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s1">&#39;Ã—&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="n">age</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">when</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;10æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">when</span><span class="w"> </span><span class="mi">20</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;20æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">when</span><span class="w"> </span><span class="mi">30</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;30æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">when</span><span class="w"> </span><span class="mi">40</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;40æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">when</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;50æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;60æ­³ä»£&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">gender_era_label</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-058-">S-058 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-058-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®æ€§åˆ¥ã‚³ãƒ¼ãƒ‰(gender_cd)ã‚’<strong>ãƒ€ãƒŸãƒ¼å¤‰æ•°åŒ–</strong>ã—ã€é¡§å®¢ID (customer_id)ã¨ã¨ã‚‚ã«æŠ½å‡ºã›ã‚ˆã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">gender_cd</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">male</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">gender_cd</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">female</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">gender_cd</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">unknown</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>cf. <a href="https://octopus.nehan.io/manual/3375/">ãƒ€ãƒŸãƒ¼å¤‰æ•°</a> nehan</p>
<h3 id="s-059-">S-059 â˜…<a class="anchor" aria-hidden="true" href="#s-059-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢ID(customer_id)ã”ã¨ã« åˆè¨ˆã—ã€å£²ä¸Šé‡‘é¡åˆè¨ˆã‚’<strong>å¹³å‡0ã€æ¨™æº–åå·®1ã«æ¨™æº–åŒ–</strong>ã—ã¦é¡§å®¢IDã€å£²ä¸Šé‡‘é¡åˆè¨ˆã¨ã¨ã‚‚ã«è¡¨ ç¤ºã›ã‚ˆã€‚æ¨™æº–åŒ–ã«ä½¿ç”¨ã™ã‚‹æ¨™æº–åå·®ã¯ã€ä¸åæ¨™æº–åå·®ã¨æ¨™æœ¬æ¨™æº–åå·®ã®ã©ã¡ã‚‰ã§ã‚‚è‰¯ã„ã‚‚ ã®ã¨ã™ã‚‹ã€‚ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ ã‚‹ã“ã¨ã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">user_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">where</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">standerd_scaler</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="p">,</span><span class="w"> </span><span class="n">stddev_pop</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">from</span><span class="w"> </span><span class="n">user_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="o">/</span><span class="n">std</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ss_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">standerd_scaler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf.<a href="https://bellcurve.jp/statistics/course/19647.html">6-2. ãƒ‡ãƒ¼ã‚¿ã‚’æ¨™æº–åŒ–ã—ã¦ã¿ã‚ˆã†</a> - çµ±è¨ˆWEB</p>
<pre tabindex="0"><code>%%sql

WITH sales_amount AS(
    SELECT
        customer_id,
        SUM(amount) as sum_amount
    FROM
        receipt
    WHERE
        customer_id NOT LIKE &#39;Z%&#39;
    GROUP BY
        customer_id
),
stats_amount AS (
    SELECT
        AVG(sum_amount) as avg_amount,
        stddev_pop(sum_amount) as std_amount
    FROM
        sales_amount
)
SELECT
    customer_id,
    sum_amount,
    (sum_amount - avg_amount) / std_amount as normal_amount
FROM sales_amount
CROSS JOIN stats_amount
LIMIT 10
</code></pre><h3 id="s-060-">S-060 â˜…<a class="anchor" aria-hidden="true" href="#s-060-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢ID(customer_id)ã”ã¨ã« åˆè¨ˆã—ã€å£²ä¸Šé‡‘é¡åˆè¨ˆã‚’<strong>æœ€å°å€¤0ã€æœ€å¤§å€¤1ã«æ­£è¦åŒ–</strong>ã—ã¦é¡§å®¢IDã€å£²ä¸Šé‡‘é¡åˆè¨ˆã¨ã¨ã‚‚ã«è¡¨ ç¤ºã›ã‚ˆã€‚ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ ã“ã¨ã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">user_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">where</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">min_max_scaler</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="p">,</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">min</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">from</span><span class="w"> </span><span class="n">user_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="k">max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">min</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mm_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">min_max_scaler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://atmarkit.itmedia.co.jp/ait/articles/2110/07/news027.html">æ­£è¦åŒ–ï¼ˆNormalizationï¼‰ï¼æ¨™æº–åŒ–ï¼ˆStandardizationï¼‰ã¨ã¯ï¼Ÿ</a> -@IT</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">%%</span><span class="k">sql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WITH</span><span class="w"> </span><span class="n">sales_amount</span><span class="w"> </span><span class="k">AS</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sum_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">receipt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">stats_amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">max</span><span class="p">(</span><span class="n">sum_amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">max_amount</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">min</span><span class="p">(</span><span class="n">sum_amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">min_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">sales_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sum_amount</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="n">sum_amount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">min_amount</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">max_amount</span><span class="w"> </span><span class="o">-</span><span class="w">  </span><span class="n">min_amount</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">scale_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sales_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">stats_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-061-">S-061 â˜…<a class="anchor" aria-hidden="true" href="#s-061-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢ID(customer_id)ã”ã¨ã« åˆè¨ˆã—ã€å£²ä¸Šé‡‘é¡åˆè¨ˆã‚’**å¸¸ç”¨å¯¾æ•°åŒ–(åº•=10)**ã—ã¦é¡§å®¢IDã€å£²ä¸Šé‡‘é¡åˆè¨ˆã¨ã¨ã‚‚ã«è¡¨ç¤ºã› ã‚ˆã€‚ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ã“ ã¨ã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">log10</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">log_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">user_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://www.sql-reference.com/math/log.html">å¯¾æ•°(è‡ªç„¶å¯¾æ•°,å¸¸ç”¨å¯¾æ•°)ã‚’æ±‚ã‚ã‚‹</a> - é€†å¼•ãSQLæ§‹æ–‡é›†</p>
<h3 id="s-062-">S-062 â˜…<a class="anchor" aria-hidden="true" href="#s-062-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢ID(customer_id)ã”ã¨ã« åˆè¨ˆã—ã€å£²ä¸Šé‡‘é¡åˆè¨ˆã‚’**è‡ªç„¶å¯¾æ•°åŒ–(åº•=e)**ã—ã¦é¡§å®¢IDã€å£²ä¸Šé‡‘é¡åˆè¨ˆã¨ã¨ã‚‚ã«è¡¨ç¤ºã›ã‚ˆ (ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ã“ ã¨)ã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">select</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">where</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">log_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">user_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">%%</span><span class="k">sql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LN</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">log_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">receipt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-063-">S-063 â˜…<a class="anchor" aria-hidden="true" href="#s-063-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®å˜ä¾¡(unit_price)ã¨åŸä¾¡(unit_cost)ã‹ã‚‰ã€å„å•†å“ã®åˆ©ç›Šé¡ ã‚’ç®—å‡ºã›ã‚ˆã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">profit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-064-">S-064 â˜…<a class="anchor" aria-hidden="true" href="#s-064-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®å˜ä¾¡(unit_price)ã¨åŸä¾¡(unit_cost)ã‹ã‚‰ã€å„å•†å“ã®åˆ©ç›Šç‡ ã®å…¨ä½“å¹³å‡ã‚’ç®—å‡ºã›ã‚ˆã€‚ ãŸã ã—ã€å˜ä¾¡ã¨åŸä¾¡ã«ã¯NULLãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã«æ³¨æ„ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">profit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">profit_rate</span><span class="w"> </span><span class="c1">-- å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">((</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mean_profit_rate</span><span class="w"> </span><span class="c1">-- å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰å¹³å‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf.<a href="https://www.unchi-co.com/kaigyoblog/kigyo_kaigyo/riekiritsu.html">ã€è¶…ã‚«ãƒ³ã‚¿ãƒ³ï¼ã€‘åˆ©ç›Šç‡ã®è¨ˆç®—æ–¹æ³•ãƒ»å‡ºã—æ–¹ã‚’å›³è§£ã§ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¾ã™</a> - Theä¼æ¥­ï¼†é£²é£ŸçµŒå–¶</p>
<pre tabindex="0"><code>%%sql

SELECT
    AVG((unit_price * 1.0 - unit_cost) / unit_price) as unit_profit_rate
FROM
    product
LIMIT 10
</code></pre><h3 id="s-065-">S-065 â˜…<a class="anchor" aria-hidden="true" href="#s-065-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®å„å•†å“ã«ã¤ã„ã¦ã€åˆ©ç›Šç‡ãŒ30%ã¨ãªã‚‹æ–°ãŸãªå˜ä¾¡ã‚’æ±‚ã‚ã‚ˆã€‚ ãŸã ã—ã€1å††æœªæº€ã¯åˆ‡ã‚Šæ¨ã¦ã‚‹ã“ã¨ã€‚ãã—ã¦çµæœã‚’10ä»¶è¡¨ç¤ºã•ã›ã€åˆ©ç›Šç‡ãŒãŠã‚ˆã30%ä»˜è¿‘ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã›ã‚ˆã€‚ãŸã ã—ã€å˜ä¾¡(unit_price)ã¨åŸä¾¡(unit_cost)ã«ã¯NULLãŒ å­˜åœ¨ã™ã‚‹ã“ã¨ã«æ³¨æ„ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unit_cost</span><span class="w"> </span><span class="c1">-- åŸä¾¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="c1">-- å˜ä¾¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="c1">-- å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">((</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">profit_rate</span><span class="w"> </span><span class="c1">-- å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="cm">/* æ–°å˜ä¾¡(å¼å¤‰æ›)
</span></span></span><span class="line"><span class="cl"><span class="cm">         * (p-c) / p  = 0.3
</span></span></span><span class="line"><span class="cl"><span class="cm">         *      p - c = 0.3p
</span></span></span><span class="line"><span class="cl"><span class="cm">         *          p = c / 0.7 âˆ´
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_unit_price</span><span class="w"> </span><span class="c1">-- æ–°å˜ä¾¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">((</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_profit</span><span class="w"> </span><span class="c1">-- æ–°å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(((</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_profit_rate</span><span class="w"> </span><span class="c1">-- æ–°å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-066-">S-066 â˜…<a class="anchor" aria-hidden="true" href="#s-066-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®å„å•†å“ã«ã¤ã„ã¦ã€åˆ©ç›Šç‡ãŒ30%ã¨ãªã‚‹æ–°ãŸãªå˜ä¾¡ã‚’æ±‚ã‚ã‚ˆã€‚ ä»Šå›ã¯ã€1å††æœªæº€ã‚’ä¸¸ã‚ã‚‹ã“ã¨(å››æ¨äº”å…¥ã¾ãŸã¯å¶æ•°ã¸ã®ä¸¸ã‚ã§è‰¯ã„)ã€‚ãã—ã¦çµæœã‚’10 ä»¶è¡¨ç¤ºã•ã›ã€åˆ©ç›Šç‡ãŒãŠã‚ˆã30%ä»˜è¿‘ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã›ã‚ˆã€‚ãŸã ã—ã€å˜ä¾¡ (unit_price)ã¨åŸä¾¡(unit_cost)ã«ã¯NULLãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã«æ³¨æ„ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unit_cost</span><span class="w"> </span><span class="c1">-- åŸä¾¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="c1">-- å˜ä¾¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">profit</span><span class="w"> </span><span class="c1">-- å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">((</span><span class="n">unit_price</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">profit_rate</span><span class="w"> </span><span class="c1">-- å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_unit_price</span><span class="w"> </span><span class="c1">-- æ–°å˜ä¾¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">((</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_profit</span><span class="w"> </span><span class="c1">-- æ–°å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(((</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_profit_rate</span><span class="w"> </span><span class="c1">-- æ–°å£²ä¸Šç·åˆ©ç›Šï¼ˆç²—åˆ©ï¼‰ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-067-">S-067 â˜…<a class="anchor" aria-hidden="true" href="#s-067-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®å„å•†å“ã«ã¤ã„ã¦ã€åˆ©ç›Šç‡ãŒ30%ã¨ãªã‚‹æ–°ãŸãªå˜ä¾¡ã‚’æ±‚ã‚ã‚ˆã€‚ ä»Šå›ã¯ã€1å††æœªæº€ã‚’åˆ‡ã‚Šä¸Šã’ã‚‹ã“ã¨ã€‚ãã—ã¦çµæœã‚’10ä»¶è¡¨ç¤ºã•ã›ã€åˆ©ç›Šç‡ãŒãŠã‚ˆã30%ä»˜è¿‘ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã›ã‚ˆã€‚ãŸã ã—ã€å˜ä¾¡(unit_price)ã¨åŸä¾¡(unit_cost)ã«ã¯NULLãŒ å­˜åœ¨ã™ã‚‹ã“ã¨ã«æ³¨æ„ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">ceil</span><span class="p">((</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="n">unit_cost</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">new_unit_price_rate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-068-">S-068 â˜…<a class="anchor" aria-hidden="true" href="#s-068-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®å„å•†å“ã«ã¤ã„ã¦ã€æ¶ˆè²»ç¨ç‡10%ã®ç¨è¾¼ã¿é‡‘é¡ã‚’æ±‚ã‚ã‚ˆã€‚1å††æœª æº€ã®ç«¯æ•°ã¯åˆ‡ã‚Šæ¨ã¦ã¨ã—ã€çµæœã¯10ä»¶è¡¨ç¤ºã™ã‚Œã°è‰¯ã„ã€‚ãŸã ã—ã€å˜ä¾¡(unit_price)ã«ã¯NULLãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã«æ³¨æ„ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- , unit_cost
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="n">unit_price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tax</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-069-">S-069 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-069-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã¨å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã‚’çµåˆã—ã€é¡§å®¢æ¯ã«å…¨å•†å“ã®å£²ä¸Šé‡‘é¡åˆè¨ˆã¨ã€ã‚«ãƒ†ã‚´ãƒªå¤§åŒºåˆ†(category_major_cd)ãŒ&quot;07&quot;(ç“¶è©°ç¼¶è©°)ã®å£²ä¸Šé‡‘é¡åˆè¨ˆã‚’è¨ˆç®—ã®ä¸Šã€ä¸¡è€…ã®æ¯”ç‡ã‚’æ±‚ã‚ã‚ˆã€‚æŠ½å‡ºå¯¾è±¡ã¯ã‚«ãƒ†ã‚´ãƒªå¤§åŒºåˆ†&quot;07&quot;(ç“¶è©°ç¼¶è©°)ã® å£²ä¸Šå®Ÿç¸¾ãŒã‚ã‚‹é¡§å®¢ã®ã¿ã¨ã—ã€çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°ã‚ˆã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">left</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">product_cd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">user_all_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">user_07_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount_07</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">category_major_cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">07</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">amount_07</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">amount_all</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_all_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">user_07_amount</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-070-">S-070 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-070-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šæ—¥(sales_ymd)ã«å¯¾ã—ã€é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ« (customer)ã®ä¼šå“¡ç”³è¾¼æ—¥(application_date)ã‹ã‚‰ã®çµŒéæ—¥æ•°ã‚’è¨ˆç®—ã—ã€é¡§å®¢ID (customer_id)ã€å£²ä¸Šæ—¥ã€ä¼šå“¡ç”³è¾¼æ—¥ã¨ã¨ã‚‚ã«è¡¨ç¤ºã›ã‚ˆã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ (ãªãŠã€sales_ymdã¯æ•°å€¤ã€application_dateã¯æ–‡å­—åˆ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ã„ã‚‹ç‚¹ã«æ³¨æ„)ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">application_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">date_diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://qiita.com/hogeta_/items/1416135863a023a09127">Bigqueryã®æ—¥æ™‚ã«é–¢ä¿‚ã™ã‚‹é–¢æ•°å…¨éƒ¨è©¦ã—ã¦ã¿ãŸ â‘ Dateç·¨</a> Qiita</p>
<h3 id="s-071-">S-071 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-071-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šæ—¥(sales_ymd)ã«å¯¾ã—ã€é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ« (customer)ã®ä¼šå“¡ç”³è¾¼æ—¥(application_date)ã‹ã‚‰ã®çµŒéæœˆæ•°ã‚’è¨ˆç®—ã—ã€é¡§å®¢ID (customer_id)ã€å£²ä¸Šæ—¥ã€ä¼šå“¡ç”³è¾¼æ—¥ã¨ã¨ã‚‚ã«è¡¨ç¤ºã›ã‚ˆã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ (ãªãŠã€sales_ymdã¯æ•°å€¤ã€application_dateã¯æ–‡å­—åˆ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ã„ã‚‹ç‚¹ã«æ³¨æ„)ã€‚1ãƒ¶æœˆæœªæº€ã¯åˆ‡ã‚Šæ¨ã¦ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">application_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">month_diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">month_diff</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-072-">S-072 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-072-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šæ—¥(sales_ymd)ã«å¯¾ã—ã€é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ« (customer)ã®ä¼šå“¡ç”³è¾¼æ—¥(application_date)ã‹ã‚‰ã®çµŒéå¹´æ•°ã‚’è¨ˆç®—ã—ã€é¡§å®¢ID (customer_id)ã€å£²ä¸Šæ—¥ã€ä¼šå“¡ç”³è¾¼æ—¥ã¨ã¨ã‚‚ã«è¡¨ç¤ºã›ã‚ˆã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ (ãªãŠã€sales_ymdã¯æ•°å€¤ã€application_dateã¯æ–‡å­—åˆ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ã„ã‚‹ç‚¹ã«æ³¨ æ„)ã€‚1å¹´æœªæº€ã¯åˆ‡ã‚Šæ¨ã¦ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">application_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">yaer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">year_diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">year_diff</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-073-">S-073 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-073-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šæ—¥(sales_ymd)ã«å¯¾ã—ã€é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ« (customer)ã®ä¼šå“¡ç”³è¾¼æ—¥(application_date)ã‹ã‚‰ã®ã‚¨ãƒãƒƒã‚¯ç§’ã«ã‚ˆã‚‹çµŒéæ™‚é–“ã‚’è¨ˆç®—ã—ã€é¡§å®¢ID(customer_id)ã€å£²ä¸Šæ—¥ã€ä¼šå“¡ç”³è¾¼æ—¥ã¨ã¨ã‚‚ã«è¡¨ç¤ºã›ã‚ˆã€‚çµæœã¯10ä»¶è¡¨ç¤ºã• ã›ã‚Œã°è‰¯ã„(ãªãŠã€sales_ymdã¯æ•°å€¤ã€application_dateã¯æ–‡å­—åˆ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ã„ ã‚‹ç‚¹ã«æ³¨æ„)ã€‚ãªãŠã€æ™‚é–“æƒ…å ±ã¯ä¿æœ‰ã—ã¦ã„ãªã„ãŸã‚å„æ—¥ä»˜ã¯0æ™‚0åˆ†0ç§’ã‚’è¡¨ã™ã‚‚ã®ã¨ã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">application_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">datetime</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c1">-- , format_date(&#39;%Y&#39;, parse_date(&#39;%Y%m%d&#39;, cast(sales_ymd as string)))
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">              </span><span class="k">cast</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_ymd_time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">datetime</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">cast</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">application_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">application_date_time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">application_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">datetime_diff</span><span class="p">(</span><span class="n">sales_ymd_time</span><span class="p">,</span><span class="w"> </span><span class="n">application_date_time</span><span class="p">,</span><span class="w"> </span><span class="k">second</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://ja.wikipedia.org/wiki/UNIX%E6%99%82%E9%96%93">UNIXæ™‚é–“</a> Wikipedia</p>
<h3 id="s-074-">S-074 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-074-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šæ—¥(sales_ymd)ã«å¯¾ã—ã€å½“è©²é€±ã®æœˆæ›œæ—¥ã‹ã‚‰ã®çµŒéæ—¥æ•°ã‚’è¨ˆç®—ã—ã€å£²ä¸Šæ—¥ã€å½“è©²é€±ã®æœˆæ›œæ—¥ä»˜ã¨ã¨ã‚‚ã«è¡¨ç¤ºã›ã‚ˆã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„(ãªãŠã€sales_ymdã¯æ•°å€¤ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ã„ã‚‹ç‚¹ã«æ³¨æ„)ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- , application_date
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">sales_ymd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">date_trunc</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">)),</span><span class="w"> </span><span class="n">week</span><span class="p">(</span><span class="n">monday</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_ymd_on_monday</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">date_diff</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">date_trunc</span><span class="p">(</span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">)),</span><span class="w"> </span><span class="n">week</span><span class="p">(</span><span class="n">monday</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="k">day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">date_diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf.<a href="https://apl-py.com/tec/bigquery%E5%AF%BE%E8%B1%A1%E6%97%A5%E4%BB%98%E3%82%92%E5%9F%BA%E6%BA%96%E3%81%AB%E3%81%97%E3%81%A6%E3%80%81%E7%89%B9%E5%AE%9A%E6%9B%9C%E6%97%A5%E3%81%AE%E6%97%A5%E4%BB%98%E3%82%92%E6%8A%BD%E5%87%BA">[bigquery]å¯¾è±¡æ—¥ä»˜ã‚’åŸºæº–ã«ã—ã¦ã€ç‰¹å®šæ›œæ—¥ã®æ—¥ä»˜ã‚’æŠ½å‡ºã™ã‚‹æ–¹æ³•</a> - ç›®é»’ã§åƒãåˆ†ææ‹…å½“ã®ä½œæ¥­ãƒ¡ãƒ¢</p>
<h3 id="s-075-">S-075 â˜…<a class="anchor" aria-hidden="true" href="#s-075-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1%ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã€å…ˆé ­ã‹ã‚‰10ä»¶ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">random_tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">mod</span><span class="p">(</span><span class="k">abs</span><span class="p">(</span><span class="n">farm_fingerprint</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">rn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))),</span><span class="w"> </span><span class="mi">220</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">random_tb</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://medium.com/@sfujiwara/bigquery-%E3%81%A7%E3%83%A9%E3%83%B3%E3%83%80%E3%83%A0%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AA%E3%83%B3%E3%82%B0-807d64d1c2be">BigQuery ã§ãƒ©ãƒ³ãƒ€ãƒ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</a> medium</p>
<pre tabindex="0"><code>%%sql

-- ã‚³ãƒ¼ãƒ‰ä¾‹ï¼‘ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã«ã‚„ã‚‹ãªã‚‰ï¼‰
SELECT * FROM customer WHERE RANDOM() &lt;= 0.01
LIMIT 10
</code></pre><p>â€»ãƒ¬ã‚¬ã‚·ãƒ¼SQLã‚„PostgreSQLä¸Šè¨˜ã®ã‚ˆã†ã«ç°¡æ˜“çš„ã«ã‹ã‘ã‚‹ã€‚</p>
<h3 id="s-076-">S-076 â˜…â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-076-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã‹ã‚‰æ€§åˆ¥(gender_cd)ã®å‰²åˆã«åŸºã¥ããƒ©ãƒ³ãƒ€ãƒ ã«10%ã®ãƒ‡ãƒ¼ã‚¿ã‚’<strong>å±¤åŒ–æŠ½å‡º</strong>ã—ã€æ€§åˆ¥ã”ã¨ã«ä»¶æ•°ã‚’é›†è¨ˆã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">gender_cd</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">gender_cd_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">gender_cd</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">gender_ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">gender_cd</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/*********************************************
</span></span></span><span class="line"><span class="cl"><span class="cm">     * male=2,981 female=17,918 all=20,899
</span></span></span><span class="line"><span class="cl"><span class="cm">     * male=2,981/20,899  female=17,918/20,899
</span></span></span><span class="line"><span class="cl"><span class="cm">     * male=14            female=86
</span></span></span><span class="line"><span class="cl"><span class="cm">     * male:female=14:86
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * male=2,981/14       female=17,918/86
</span></span></span><span class="line"><span class="cl"><span class="cm">     * male=212            female=208
</span></span></span><span class="line"><span class="cl"><span class="cm">     *********************************************/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">stratified_sampling_gender_0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">gender_cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">mod</span><span class="p">(</span><span class="k">abs</span><span class="p">(</span><span class="n">farm_fingerprint</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">rn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))),</span><span class="w"> </span><span class="mi">212</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">stratified_sampling_gender_1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">gender_cd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">mod</span><span class="p">(</span><span class="k">abs</span><span class="p">(</span><span class="n">farm_fingerprint</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">rn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">))),</span><span class="w"> </span><span class="mi">208</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">stratified_sampling_gender_1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">stratified_sampling_gender_0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>cf.
<ul>
<li><a href="https://bellcurve.jp/statistics/course/8007.html">16-3. æ¨™æœ¬ã®æŠ½å‡ºæ–¹æ³•</a> çµ±è¨ˆWEB</li>
<li><a href="https://qiita.com/ognek/items/c590fa34ca7a59a2e284">BigQueryã§ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</a> Qiita</li>
</ul>
</li>
</ul>
<h3 id="s-077-">S-077 â˜…<a class="anchor" aria-hidden="true" href="#s-077-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢å˜ä½ã«åˆè¨ˆã—ã€åˆè¨ˆã—ãŸå£²ä¸Šé‡‘é¡ã®å¤–ã‚Œå€¤ã‚’æŠ½å‡ºã›ã‚ˆã€‚
ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ã€‚ãªãŠã€ã“ã“ã§ã¯å¤–ã‚Œå€¤ã‚’å¹³å‡ã‹ã‚‰3Ïƒä»¥ä¸Šé›¢ã‚ŒãŸã‚‚ã®ã¨ã™ã‚‹ã€‚çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">stddev</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">siguma</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">stddev</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">())</span><span class="o">*</span><span class="mi">3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">siguma_3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">user_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">statistics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">amount</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="o">-</span><span class="n">siguma</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="o">+</span><span class="n">siguma_3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-078-">S-078 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-078-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã®å£²ä¸Šé‡‘é¡(amount)ã‚’é¡§å®¢å˜ä½ã«åˆè¨ˆã—ã€åˆè¨ˆã—ãŸå£²ä¸Šé‡‘é¡ã®å¤–ã‚Œå€¤ã‚’æŠ½å‡ºã›ã‚ˆã€‚
ãŸã ã—ã€é¡§å®¢IDãŒ&quot;Z&quot;ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚‚ã®ã¯éä¼šå“¡ã‚’è¡¨ã™ãŸã‚ã€é™¤å¤–ã—ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ã€‚
ãªãŠã€ã“ã“ã§ã¯å¤–ã‚Œå€¤ã‚’ç¬¬ä¸€å››åˆ†ä½ã¨ç¬¬ä¸‰å››åˆ†ä½ã®å·®ã§ã‚ã‚‹IQRã‚’ç”¨ã„ã¦ã€ã€Œç¬¬ä¸€å››åˆ†ä½æ•°-1.5Ã—IQRã€ã‚ˆã‚Šã‚‚ä¸‹å›ã‚‹ã‚‚ã®ã€ã¾ãŸã¯ã€Œç¬¬ä¸‰å››åˆ†ä½æ•°+1.5 Ã—IQRã€ã‚’è¶…ãˆã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚
çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">user_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Z%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">mean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">stddev</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">siguma</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">min</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">median</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">75</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">IQR</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">user_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">statistics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q1</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">IQR</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">or</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">q3</span><span class="o">+</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="o">*</span><span class="n">IQR</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf.</p>
<blockquote>
<p><a href="https://bellcurve.jp/statistics/course/5222.html">4-3. å¤–ã‚Œå€¤æ¤œå‡ºã®ã‚ã‚‹ç®±ã²ã’å›³</a> - çµ±è¨ˆWEB</p>
<img src='https://bellcurve.jp/statistics/wp-body/wp-content/uploads/2016/05/795316b92fc766b0181f6fef074f03fa-16.png' width=80%></blockquote>
<h3 id="s-079-">S-079 â˜…<a class="anchor" aria-hidden="true" href="#s-079-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®å„é …ç›®ã«å¯¾ã—ã€æ¬ ææ•°ã‚’ç¢ºèªã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">col_data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">column_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">data_type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">null_tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;product_cd&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">null_ct</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">product_cd</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;category_major_cd&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">null_ct</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">category_major_cd</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;category_medium_cd&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">null_ct</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">category_medium_cd</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;category_small_cd&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">null_ct</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">category_small_cd</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;unit_price&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">null_ct</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="s1">&#39;unit_cost&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">null_ct</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knoks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">unit_cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">col_data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">join</span><span class="w"> </span><span class="n">null_tb</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="k">key</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-080-">S-080 â˜…<a class="anchor" aria-hidden="true" href="#s-080-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã®ã„ãšã‚Œã‹ã®é …ç›®ã«æ¬ æãŒç™ºç”Ÿã—ã¦ã„ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ã¦å‰Šé™¤ã—ãŸæ–°ãŸãªproduct_1ã‚’ä½œæˆã›ã‚ˆã€‚ãªãŠã€å‰Šé™¤å‰å¾Œã®ä»¶æ•°ã‚’è¡¨ç¤ºã•ã›ã€å‰è¨­å•ã§ç¢ºèªã—ãŸä»¶æ•°ã ã‘æ¸›å°‘ã—ã¦ã„ã‚‹ã“ã¨ã‚‚ç¢ºèªã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- remove null inharit records.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">product_1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">unit_cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;å‰Šé™¤å‰&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">union</span><span class="w"> </span><span class="k">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;å‰Šé™¤å¾Œ&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">product_1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-081-">S-081 â˜…<a class="anchor" aria-hidden="true" href="#s-081-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å˜ä¾¡(unit_price)ã¨åŸä¾¡(unit_cost)ã®æ¬ æå€¤ã«ã¤ã„ã¦ã€ãã‚Œãã‚Œã®å¹³å‡å€¤ã§è£œå®Œã—ãŸæ–°ãŸãªproduct_2ã‚’ä½œæˆã›ã‚ˆã€‚ãªãŠã€å¹³å‡å€¤ã«ã¤ã„ã¦ã¯1å††æœªæº€ã‚’ä¸¸ã‚ã‚‹ã“ã¨(å››æ¨äº”å…¥ã¾ãŸã¯å¶æ•°ã¸ã®ä¸¸ã‚ã§è‰¯ã„)ã€‚è£œå®Œå®Ÿæ–½å¾Œã€å„é …ç›®ã«ã¤ã„ã¦æ¬ æãŒç”Ÿã˜ã¦ã„ãªã„ã“ã¨ã‚‚ç¢ºèªã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">product_2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_major_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_medium_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_small_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">unit_price</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_mean</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">unit_cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_mean</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- where unit_price is null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">product_2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Cf. <a href="https://gitpress.io/c/google_bigquery/google_bigquery_6">ã€BIGQUERYã€‘åˆ†æå…¥é–€ - SECTION6
</a> - Gitpress</p>
<h3 id="s-082-">S-082 â˜…<a class="anchor" aria-hidden="true" href="#s-082-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å˜ä¾¡(unit_price)ã¨åŸä¾¡(unit_cost)ã®æ¬ æå€¤ã«ã¤ã„ã¦ã€ãã‚Œãã‚Œã®ä¸­å¤®å€¤ã§è£œå®Œã—ãŸ æ–°ãŸãªproduct_3ã‚’ä½œæˆã›ã‚ˆã€‚ãªãŠã€ä¸­å¤®å€¤ã«ã¤ã„ã¦ã¯1å††æœªæº€ã‚’ä¸¸ã‚ã‚‹ã“ã¨(å››æ¨äº”å…¥ã¾ ãŸã¯å¶æ•°ã¸ã®ä¸¸ã‚ã§è‰¯ã„)ã€‚è£œå®Œå®Ÿæ–½å¾Œã€å„é …ç›®ã«ã¤ã„ã¦æ¬ æãŒç”Ÿã˜ã¦ã„ãªã„ã“ã¨ã‚‚ç¢ºèª ã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">product_3</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_major_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_medium_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_small_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">from</span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">unit_price</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="k">else</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">unit_cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">from</span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- where unit_price is null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">product_3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-083-">S-083 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-083-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å˜ä¾¡(unit_price)ã¨åŸä¾¡(unit_cost)ã®æ¬ æå€¤ã«ã¤ã„ã¦ã€å„å•†å“ã®å°åŒºåˆ† (category_small_cd)ã”ã¨ã«ç®—å‡ºã—ãŸä¸­å¤®å€¤ã§è£œå®Œã—ãŸæ–°ãŸãªproduct_4ã‚’ä½œæˆã›ã‚ˆã€‚
ãªãŠã€ä¸­å¤®å€¤ã«ã¤ã„ã¦ã¯1å††æœªæº€ã‚’ä¸¸ã‚ã‚‹ã“ã¨(å››æ¨äº”å…¥ã¾ãŸã¯å¶æ•°ã¸ã®ä¸¸ã‚ã§è‰¯ã„)ã€‚
è£œå®Œå®Ÿæ–½å¾Œã€å„é …ç›®ã«ã¤ã„ã¦æ¬ æãŒç”Ÿã˜ã¦ã„ãªã„ã“ã¨ã‚‚ç¢ºèªã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">category_small_cd_gr</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">category_small_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">unit_price</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">category_small_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">product_4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">product_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_major_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_medium_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">category_small_cd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">unit_price</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">then</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">q</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">unit_price</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">category_small_cd_gr</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">unit_cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">when</span><span class="w"> </span><span class="k">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">then</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">q</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="n">percentile_cont</span><span class="p">(</span><span class="n">unit_cost</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">category_small_cd_gr</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unit_cost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">product</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- where unit_price is null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">product_4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-084-">S-084 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-084-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®å…¨é¡§å®¢ã«å¯¾ã—ã€å…¨æœŸé–“ã®å£²ä¸Šé‡‘é¡ã«å ã‚ã‚‹2019å¹´å£²ä¸Šé‡‘é¡ã®å‰²åˆã‚’è¨ˆç®—ã›ã‚ˆã€‚
ãŸã ã—ã€å£²ä¸Šå®Ÿç¸¾ãŒãªã„å ´åˆã¯0ã¨ã—ã¦æ‰±ã†ã“ã¨ã€‚
ãã—ã¦è¨ˆç®—ã—ãŸå‰² åˆãŒ0è¶…ã®ã‚‚ã®ã‚’æŠ½å‡ºã›ã‚ˆã€‚
çµæœã¯10ä»¶è¡¨ç¤ºã•ã›ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">prep_tb</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">format_date</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;%Y%m%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">sales_ymd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">string</span><span class="p">)))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sales_y</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">receipt</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="o">`</span><span class="n">project</span><span class="p">.</span><span class="mi">100</span><span class="n">knocks</span><span class="p">.</span><span class="n">customer</span><span class="o">`</span><span class="w"> </span><span class="k">using</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- (select sum(amount) as ttl_amount from prep_tb)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_amount_2019</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">prep_tb</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ttl_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">prep_tb</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ratio</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">prep_tb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2019&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="s-085-">S-085 â˜…<a class="anchor" aria-hidden="true" href="#s-085-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®å…¨é¡§å®¢ã«å¯¾ã—ã€éƒµä¾¿ç•ªå·(postal_cd)ã‚’ç”¨ã„ã¦çµŒåº¦ç·¯åº¦å¤‰ æ›ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«(geocode)ã‚’ç´ä»˜ã‘ã€æ–°ãŸãªcustomer_1ã‚’ä½œæˆã›ã‚ˆã€‚ãŸã ã—ã€è¤‡æ•°ç´ã¥ã å ´åˆã¯çµŒåº¦(longitude)ã€ç·¯åº¦(latitude)ãã‚Œãã‚Œå¹³å‡ã‚’ç®—å‡ºã™ã‚‹ã“ã¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-086-">S-086 â˜…â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-086-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å‰è¨­å•ã§ä½œæˆã—ãŸç·¯åº¦çµŒåº¦ã¤ãé¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer_1)ã«å¯¾ã—ã€ç”³è¾¼ã¿åº—èˆ—ã‚³ãƒ¼ãƒ‰ (application_store_cd)ã‚’ã‚­ãƒ¼ã«åº—èˆ—ãƒ†ãƒ¼ãƒ–ãƒ«(store)ã¨çµåˆã›ã‚ˆã€‚ãã—ã¦ç”³è¾¼ã¿åº—èˆ— ã®ç·¯åº¦(latitude)ãƒ»çµŒåº¦æƒ…å ±(longitude)ã¨é¡§å®¢ã®ç·¯åº¦ãƒ»çµŒåº¦ã‚’ç”¨ã„ã¦è·é›¢(km)ã‚’æ±‚ ã‚ã€é¡§å®¢ID(customer_id)ã€é¡§å®¢ä½æ‰€(address)ã€åº—èˆ—ä½æ‰€(address)ã¨ã¨ã‚‚ã«è¡¨ç¤º ã›ã‚ˆã€‚è¨ˆç®—å¼ã¯ç°¡æ˜“å¼ã§è‰¯ã„ã‚‚ã®ã¨ã™ã‚‹ãŒã€ãã®ä»–ç²¾åº¦ã®é«˜ã„æ–¹å¼ã‚’åˆ©ç”¨ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª ã‚’åˆ©ç”¨ã—ã¦ã‚‚ã‹ã¾ã‚ãªã„ã€‚çµæœã¯10ä»¶è¡¨ç¤ºã™ã‚Œã°è‰¯ã„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-087-">S-087 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-087-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã§ã¯ã€ç•°ãªã‚‹åº—èˆ—ã§ã®ç”³è¾¼ã¿ãªã©ã«ã‚ˆã‚ŠåŒä¸€é¡§å®¢ãŒè¤‡æ•°ç™»éŒ²ã• ã‚Œã¦ã„ã‚‹ã€‚åå‰(customer_name)ã¨éƒµä¾¿ç•ªå·(postal_cd)ãŒåŒã˜é¡§å®¢ã¯åŒä¸€é¡§å®¢ã¨ã¿ ãªã—ã€1é¡§å®¢1ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ãªã‚‹ã‚ˆã†ã«åå¯„ã›ã—ãŸåå¯„é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer_u)ã‚’ä½œæˆ ã›ã‚ˆã€‚ãŸã ã—ã€åŒä¸€é¡§å®¢ã«å¯¾ã—ã¦ã¯å£²ä¸Šé‡‘é¡åˆè¨ˆãŒæœ€ã‚‚é«˜ã„ã‚‚ã®ã‚’æ®‹ã™ã‚‚ã®ã¨ã—ã€å£²ä¸Šé‡‘ é¡åˆè¨ˆãŒåŒä¸€ã‚‚ã—ãã¯å£²ä¸Šå®Ÿç¸¾ãŒãªã„é¡§å®¢ã«ã¤ã„ã¦ã¯é¡§å®¢ID(customer_id)ã®ç•ªå·ãŒå° ã•ã„ã‚‚ã®ã‚’æ®‹ã™ã“ã¨ã¨ã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-088-">S-088 â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-088-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å‰è¨­å•ã§ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã€é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«ã«çµ±åˆåå¯„IDã‚’ä»˜ä¸ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ« (customer_n)ã‚’ä½œæˆã›ã‚ˆã€‚ãŸã ã—ã€çµ±åˆåå¯„IDã¯ä»¥ä¸‹ã®ä»•æ§˜ã§ä»˜ä¸ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚</p>
<ul>
<li>é‡è¤‡ã—ã¦ã„ãªã„é¡§å®¢:é¡§å®¢ID(customer_id)ã‚’è¨­å®š</li>
<li>é‡è¤‡ã—ã¦ã„ã‚‹é¡§å®¢:å‰è¨­å•ã§æŠ½å‡ºã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®é¡§å®¢IDã‚’è¨­å®š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-089-">S-089 â˜…<a class="anchor" aria-hidden="true" href="#s-089-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å£²ä¸Šå®Ÿç¸¾ãŒã‚ã‚‹é¡§å®¢ã«å¯¾ã—ã€äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ã®ãŸã‚å­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿ã¨ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã«åˆ†å‰² ã—ãŸã„ã€‚ãã‚Œãã‚Œ8:2ã®å‰²åˆã§ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-090-">S-090 â˜…â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-090-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>ãƒ¬ã‚·ãƒ¼ãƒˆæ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«(receipt)ã¯2017å¹´1æœˆ1æ—¥ã€œ2019å¹´10æœˆ31æ—¥ã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ã‚’æœ‰ã— ã¦ã„ã‚‹ã€‚å£²ä¸Šé‡‘é¡(amount)ã‚’æœˆæ¬¡ã§é›†è¨ˆã—ã€å­¦ç¿’ç”¨ã«12ãƒ¶æœˆã€ãƒ†ã‚¹ãƒˆç”¨ã«6ãƒ¶æœˆã®ãƒ¢ãƒ‡ ãƒ«æ§‹ç¯‰ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’3ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦ã‚»ãƒƒãƒˆä½œæˆã›ã‚ˆã€‚ãƒ‡ãƒ¼ã‚¿ã®æŒã¡æ–¹ã¯è‡ªç”±ã¨ã™ã‚‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-091-">S-091 â˜…â˜…â˜…<a class="anchor" aria-hidden="true" href="#s-091-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã®å„é¡§å®¢ã«å¯¾ã—ã€å£²ä¸Šå®Ÿç¸¾ãŒã‚ã‚‹é¡§å®¢æ•°ã¨å£²ä¸Šå®Ÿç¸¾ãŒãªã„é¡§å®¢ æ•°ãŒ1:1ã¨ãªã‚‹ã‚ˆã†ã«ã‚¢ãƒ³ãƒ€ãƒ¼ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§æŠ½å‡ºã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-092-">S-092 â˜…<a class="anchor" aria-hidden="true" href="#s-092-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«(customer)ã§ã¯ã€æ€§åˆ¥ã«é–¢ã™ã‚‹æƒ…å ±ãŒéæ­£è¦åŒ–ã®çŠ¶æ…‹ã§ä¿æŒã•ã‚Œã¦ã„ã‚‹ã€‚ ã“ã‚Œã‚’ç¬¬ä¸‰æ­£è¦åŒ–ã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-093-">S-093 â˜…<a class="anchor" aria-hidden="true" href="#s-093-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«(product)ã§ã¯å„ã‚«ãƒ†ã‚´ãƒªã®ã‚³ãƒ¼ãƒ‰å€¤ã ã‘ã‚’ä¿æœ‰ã—ã€ã‚«ãƒ†ã‚´ãƒªåã¯ä¿æœ‰ã— ã¦ã„ãªã„ã€‚ã‚«ãƒ†ã‚´ãƒªãƒ†ãƒ¼ãƒ–ãƒ«(category)ã¨çµ„ã¿åˆã‚ã›ã¦éæ­£è¦åŒ–ã—ã€ã‚«ãƒ†ã‚´ãƒªåã‚’ä¿æœ‰ ã—ãŸæ–°ãŸãªå•†å“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã›ã‚ˆã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-094-">S-094 â˜…<a class="anchor" aria-hidden="true" href="#s-094-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…ˆã«ä½œæˆã—ãŸã‚«ãƒ†ã‚´ãƒªåä»˜ãå•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ä»¥ä¸‹ã®ä»•æ§˜ã§ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã›ã‚ˆã€‚å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹ ã¯&quot;/tmp/data&quot;ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Jupyterã®&quot;/work/data&quot;ã¨å…±æœ‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ ãªãŠã€COPYã‚³ãƒãƒ³ãƒ‰ã®æ¨©é™ã¯ä»˜ä¸æ¸ˆã¿ã§ã‚ã‚‹ã€‚</p>
<ul>
<li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯CSV(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</li>
<li>ãƒ˜ãƒƒãƒ€æœ‰ã‚Š</li>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯UTF-8</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-095-">S-095 â˜…<a class="anchor" aria-hidden="true" href="#s-095-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…ˆã«ä½œæˆã—ãŸã‚«ãƒ†ã‚´ãƒªåä»˜ãå•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ä»¥ä¸‹ã®ä»•æ§˜ã§ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã›ã‚ˆã€‚å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹ ã¯&quot;/tmp/data&quot;ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Jupyterã®&quot;/work/data&quot;ã¨å…±æœ‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ ãªãŠã€COPYã‚³ãƒãƒ³ãƒ‰ã®æ¨©é™ã¯ä»˜ä¸æ¸ˆã¿ã§ã‚ã‚‹ã€‚</p>
<ul>
<li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯CSV(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</li>
<li>ãƒ˜ãƒƒãƒ€æœ‰ã‚Š</li>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯SJIS</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-096-">S-096 â˜…<a class="anchor" aria-hidden="true" href="#s-096-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…ˆã«ä½œæˆã—ãŸã‚«ãƒ†ã‚´ãƒªåä»˜ãå•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ä»¥ä¸‹ã®ä»•æ§˜ã§ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã›ã‚ˆã€‚å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹ ã¯&quot;/tmp/data&quot;ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Jupyterã®&quot;/work/data&quot;ã¨å…±æœ‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ ãªãŠã€COPYã‚³ãƒãƒ³ãƒ‰ã®æ¨©é™ã¯ä»˜ä¸æ¸ˆã¿ã§ã‚ã‚‹ã€‚</p>
<ul>
<li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯CSV(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</li>
<li>ãƒ˜ãƒƒãƒ€ç„¡ã—</li>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯UTF-8</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-097-">S-097 â˜…<a class="anchor" aria-hidden="true" href="#s-097-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…ˆã«ä½œæˆã—ãŸä»¥ä¸‹å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã›ã‚ˆã€‚ã¾ãŸã€å…ˆé ­3ä»¶ã‚’è¡¨ ç¤ºã•ã›ã€æ­£ã—ãã¨ã‚Šã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã›ã‚ˆã€‚</p>
<ul>
<li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯CSV(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</li>
<li>ãƒ˜ãƒƒãƒ€æœ‰ã‚Š</li>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯UTF-8</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-098-">S-098 â˜…<a class="anchor" aria-hidden="true" href="#s-098-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…ˆã«ä½œæˆã—ãŸä»¥ä¸‹å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã›ã‚ˆã€‚ã¾ãŸã€å…ˆé ­3ä»¶ã‚’è¡¨ ç¤ºã•ã›ã€æ­£ã—ãã¨ã‚Šã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã›ã‚ˆã€‚</p>
<ul>
<li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯CSV(ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</li>
<li>ãƒ˜ãƒƒãƒ€ç„¡ã—</li>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯UTF-8</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-099-">S-099 â˜…<a class="anchor" aria-hidden="true" href="#s-099-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…ˆã«ä½œæˆã—ãŸã‚«ãƒ†ã‚´ãƒªåä»˜ãå•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ä»¥ä¸‹ã®ä»•æ§˜ã§ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã›ã‚ˆã€‚å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹ ã¯&quot;/tmp/data&quot;ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Jupyterã®&quot;/work/data&quot;ã¨å…±æœ‰ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ ãªãŠã€COPYã‚³ãƒãƒ³ãƒ‰ã®æ¨©é™ã¯ä»˜ä¸æ¸ˆã¿ã§ã‚ã‚‹ã€‚</p>
<ul>
<li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯TSV(ã‚¿ãƒ–åŒºåˆ‡ã‚Š)</li>
<li>ãƒ˜ãƒƒãƒ€æœ‰ã‚Š</li>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯UTF-8</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h3 id="s-100-">S-100 â˜…<a class="anchor" aria-hidden="true" href="#s-100-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h3>
<p>å…ˆã«ä½œæˆã—ãŸä»¥ä¸‹å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã›ã‚ˆã€‚ã¾ãŸã€å…ˆé ­10ä»¶ã‚’è¡¨ ç¤ºã•ã›ã€æ­£ã—ãã¨ã‚Šã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã›ã‚ˆã€‚</p>
<ul>
<li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯TSV(ã‚¿ãƒ–åŒºåˆ‡ã‚Š)</li>
<li>ãƒ˜ãƒƒãƒ€æœ‰ã‚Š</li>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯UTF-8</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"></code></pre></div><h2 id="ref">REF.<a class="anchor" aria-hidden="true" href="#ref"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> </h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=mh8Z5d0-0PU">ã€ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã€‘ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯ï¼å®Ÿè£…ã¾ã§ã®é“ç¨‹</a> Youtube</li>
<li><a href="https://qiita.com/karaage0703/items/1b18b1f4ab65d35afb5f">Macã§ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯ã‚’å‹•ã‹ã™æ–¹æ³•</a> Qiita</li>
<li><a href="https://qiita.com/noguhiro2002/items/de49db61b69c3dbc9282">ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹100æœ¬ãƒãƒƒã‚¯ã‚’ã€Google Colabã¨Azure Notebooksã§æ°—è»½ã«è¡Œã„ãŸã„ï¼</a> Qiita</li>
</ul>
</article>
        </div>
        </div>
        </div>
    </div>
        
        
        
        <div class="Box mt-3 position-relative">
        <div class="Box-body px-5 pb-5">
            <article class="markdown-body entry-content container-lg">
                <h2>See Also</h2>
                <ul class="mt-2">
                    
                    <li class="p-1">
                        <div>
                            <a href="../../post/bigquery_data_analysis_on_cte/">[BigQuery] CTEs in data analyisis</a>
                            <time datetime="2024-07-20 16:13" class="no-wrap text-small ml-1">(2024-07-20 16:13)</time>
                        </div>
                        <div class="text-small text-gray mb-1 mt-1">Things to keep in mind when analyzing data using SQL.</div>
                    </li>
                    
                </ul>
            </article>
        </div>
        </div>
        
    </div>
    </div>
</main>
</div>

<script type="application/javascript" src='https://shiroimon.kithub.f5.si/js/toc.js'></script>
<link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/toc.css' />


<script
    src='https://shiroimon.kithub.f5.si/js/syntax-highlight-title.js'
    crossorigin="anonymous"
    type="application/javascript">
</script>
<link rel="stylesheet" href="../../css/syntax-highlight-title.css">









<script src="https://unpkg.com/mermaid@11/dist/mermaid.min.js" crossorigin="anonymous"></script>
<script>


(function () {
    function transformMermaidCodeBlocks() {
        var codeBlocks = document.querySelectorAll('pre > code.language-mermaid, code.language-mermaid');
        codeBlocks.forEach(function (code) {
            var pre = code.parentElement && code.parentElement.tagName.toLowerCase() === 'pre' ? code.parentElement : code;
            var container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = code.textContent;
            pre.replaceWith(container);
        });
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', transformMermaidCodeBlocks);
    } else {
        transformMermaidCodeBlocks();
    }
    
    if (window.mermaid) {
        window.mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    }
})();
</script>




  
  
  
  
  
  
    
      
    
  
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://shiroimon.kithub.f5.si/css/gitalk.css'>
<script src='https://shiroimon.kithub.f5.si/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'Ov23limCcfAvRdvUJ1de',
    clientSecret: '08c9365618f3a7434fe608970e757bba3d2369bc',
    repo: 'todayilearned',
    owner: 'shiroimon',
    admin: ["shiroimon"],
    labels: ["gitalk"],
    perPage:  10 ,
    pagerDirection: 'last',
    createIssueManually:  false ,
    distractionFreeMode:  false ,
    id: '3d7e1dcd5e0995f7f245afc47c049873'
  });
  gitalk.render('gitalk-container');
</script>



</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://shiroimon.kithub.f5.si/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://shiroimon.kithub.f5.si/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://shiroimon.kithub.f5.si/js/search.js'></script>



</html>